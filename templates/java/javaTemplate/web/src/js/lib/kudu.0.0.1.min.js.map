{"version":3,"sources":["utils/utils.js","router/router.js","utils/ajaxTracker.js","utils/simpleAjaxTracker.js","lifecycle/onInitHandler.js","lifecycle/onRemoveHandler.js","ractivelib/setupEvents.js","ractivelib/setupDefaultEvents.js","transition/fade.js","transition/intro.js","transition/outro.js","utils/severity.js","ractivelib/render/create.js","ractivelib/render/render.js","ractivelib/render/unrender.js","ractivelib/RactiveViewFactory.js","kudu.js"],"names":["define","require","utils","options","that","deferred","$","Deferred","resolve","noopPromise","promise","isPromise","o","then","isRactiveObject","_guid","objectLength","Object","keys","length","prop","count","hasOwnProperty","resolveUnknownRoutes","hashIndex","window","location","href","indexOf","defaultRoute","Error","path","router","urlPath","substr","module","newRoute","ctrl","moduleId","reject","appendHashParams","hash","params","paramStr","param","setIgnoreHashChangeOnce","newHash","currentHash","ignoreHashChangeOnce","unknownRouteResolver","cachedUrlPaths","cachedRouterParams","cachedRouterQueryParams","eventHandlers","statechange","routeload","routes","routesByPath","previousState","popstateHashchangeEventLisener","getHash","fire","init","addRoutes","addEventListener","attachEvent","loadCurrentRouteOnStateChange","on","loadCurrentRoute","fireInitialStateChange","activeRoute","key","addRoute","route","push","id","addRouteByPath","addRouteAt","index","splice","getRoutes","getRoutesByPath","eventName","eventHandler","eventArguments","Array","prototype","slice","call","arguments","i","apply","off","eventHandlerIndex","go","args","routeParams","updateRoute","tempRoute","hashPath","setHash","loadModule","ctrlRoutes","findRoutesForCtrl","testRoute","match","testCtrlRoute","console","error","debugRoute","routePath","RegExp","routeQueryParams","routeQueryParamsStr","queryString","parseRouteQueryParams","routePathSegments","split","routePathSegment","charAt","routePathKey","routeParamValue","JSON","stringify","routeParamKey","undefined","result","viewParams","parseRouteParams","segment","viewParamValue","routeToLoad","handleUnknownRoute","routeOrPromise","loadUnknownRoute","isNew","active","log","processLoadedModule","url","splitUrl","relativeUri","join","isHashEmpty","substring","urlParams","routeArguments","routerOptions","test","urlPathSegments","routePathQuestionIndex","urlPathSegment","tempParams","urlParamValue","routeSegmentIndex","routeSegment","questionmarkIndex","search","queryParams","queryParamsFromSearchString","parseArguments","searchIndex","hashPathIndex","hashBangPathIndex","queryParameters","queryParameter","queryParameterParts","value","arg","isNaN","decodeURIComponent","routerQueryParams","hit","routeQueryParameters","routeQueryParameter","query","toString","extend","idx","ajaxTracker","kudu","abortItems","promisesArray","promisesCopy","each","item","abort","globalPromise","addListeners","target","globalPromiseParam","promiseParam","data","status","jqXHR","triggerOptions","isXhr","promiseArgs","trigger","always","dataOrjqXHR","errorOrjqXHR","remove","xhr","getAllResponseHeaders","idCounter","promiseCounter","promisesMap","add","when","_id","jqpromiseArray","clear","simpleAjaxTracker","create","adaptor","jqXhr","onInitHandler","onInit","viewOptions","ractiveFnOrPromise","onRemoveHandler","onRemove","view","booleanOrPromise","bool","mvc","requestTracker","warn","setupEvents","this","transitionsEnabled","setupDefaultEvents","Ractive","defaults","onconstruct","fade","intro","done","duration","firstView","fadeIn","outro","fadeOut","fx","transition","severity","DEBUG","INFO","WARNING","ERROR","viewOrPromise","level","message","ractiveObj","isFunction","render","unrender","ractiveViewFactory","createView","renderView","unrenderView","processOnInit","onInitOptions","triggerEvent","processNewView","onInitComplete","processOnRemove","onRemoveOptions","currentMVC","callstack","reenableAnimationTracker","enable","reenableAnimations","setTimeout","viewFailed","errorArray","errors","isArray","initOptions","debug","cancelCurrentRequest","setId","obj","defineProperty","enumerable","writable","viewFactory","ajaxTrackerFn","validateInitOptions","routeOptions","routeLoaded","setupDefaultViewEvents","getDefaultTarget","simpleAjaxTrackerFn","stop","createController","arg1","e","Module","Function","setupViewEvents","renderer","enter","leave","customRenderView","renderViewWithAnimation","callViewEvent","isMainCtrlReplaced","oldCtrl","newCtrl","isMainCtrl","ctrlOptions","introOptions","introFn","outroOptions","outroFn","customLeave","leaveFn","leaveCleanupFn","leaveOptions","prevCtrl","prevView","prevRoute","unrenderViewCleanup","leavePromise","customEnter","enterOptions","enterFn","enterCleanupFn","renderViewCleanup","enterPromise","renderPromise","updateMVC","unrenderPromise"],"mappings":"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/B,EAAA,mBACAK,EAAAL,EAAA,UACAwO,EAAAxO,EAAA,WACA+R,EAAA/R,EAAA,uBACAqS,EAAArS,EAAA,6BACAwN,EAAAxN,EAAA,6BACA4N,EAAA5N,EAAA,+BACA4S,EAAA5S,EAAA,4BACAmS,EAAAnS,EAAA,mCACAyT,EAAAzT,EAAA,sBACA2T,EAAA3T,EAAA,sBACAiQ,EAAAjQ,EAAA,mCAEAqP,EAAArP,EAAA,oBACAC,EAAAD,EAAA,iBAyxBA6H,EAAAsD,GACA,OAAAtD;AhBvzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1DA,AD2DA;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACn9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtBA,ADuBA;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1EA,AD2EA;AC1EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA,ADaA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA,ADyBA;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA,AD2BA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"kudu.0.0.1.min.js","sourcesContent":["define('utils/utils',['require','jquery'],function (require) {\n\n\tvar $ = require(\"jquery\");\n\n\tfunction utils(options) {\n\n\t\tvar that = {};\n\n\t\tvar deferred = $.Deferred();\n\t\tdeferred.resolve();\n\t\tvar noopPromise = deferred.promise();\n\t\t\n\t\tthat.noopPromise = function() {\n\t\t\treturn noopPromise;\n\t\t}\n\n\t\tthat.isPromise = function (o) {\n\t\t\tif (o == null) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (typeof o.then === 'function') {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tthat.isRactiveObject = function (o) {\n\t\t\tif ((typeof o == \"object\") && (o !== null)) {\n\t\t\t\tif (o._guid != null) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tthat.objectLength = function (o) {\n\t\t\tif (Object.keys) {\n\t\t\t\treturn Object.keys(o).length;\n\t\t\t}\n\n\t\t\tvar count = 0;\n\t\t\tvar prop;\n\t\t\tfor (prop in o) {\n\t\t\t\tif (o.hasOwnProperty(prop)) {\n\t\t\t\t\tcount++;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\n\t\treturn that;\n\t}\n\n\tvar utils = utils();\n\treturn utils;\n\n});\n","// https://github.com/erikringsmuth/requirejs-router#\n// \n// RequireJS Router - A scalable, lazy loading, AMD router.\n//\n// Version: 0.8.0\n// \n// The MIT License (MIT)\n// Copyright (c) 2014 Erik Ringsmuth\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n// IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE\n// OR OTHER DEALINGS IN THE SOFTWARE.\n\ndefine('router/router',['require','jquery','../utils/utils'],function (require) {\n\t'use strict';\n\n\tvar $ = require(\"jquery\");\n\tvar utils = require(\"../utils/utils\");\n\n\t// Private closure variables\n\tvar cachedUrlPaths = {};\n\tvar cachedRouterParams = {};\n\tvar cachedRouterQueryParams = {};\n\tvar eventHandlers = {\n\t\tstatechange: [],\n\t\trouteload: []\n\t};\n\n\t// routes - All registered routes\n\tvar routes = [];\n\n\tvar routesByPath = {};\n\n\tvar unknownRouteResolver;\n\n\tvar defaultRoute;\n\n\tvar noop = function () {\n\t};\n\n\tvar ignoreHashChangeOnce = false;\n\n\tvar currentHash;\n\n\t// In some modern browsers a hashchange also fires a popstate. There isn't a check to see if the browser will fire\n\t// one or both. We have to keep track of the previous state to prevent it from fireing a statechange twice.\n\tvar previousState = '';\n\tvar popstateHashchangeEventLisener = function popstateHashchangeEventLisener() {\n\t\tif (previousState != window.location.href) {\n\t\t\tpreviousState = window.location.href;\n\t\t\tcurrentHash = router.getHash();\n\t\t\trouter.fire('statechange');\n\t\t}\n\t};\n\n\t// router public interface\n\t//\n\t// There is only one instance of the router. Loading it in multiple modules will always load the same router.\n\tvar router = {\n\t\t// router.init([options]) - initializes the router\n\t\tinit: function (options) {\n\t\t\tcurrentHash = router.getHash();\n\t\t\tif (typeof (options) === 'undefined') {\n\t\t\t\toptions = {};\n\t\t\t}\n\t\t\trouter.addRoutes(options.routes);\n\t\t\tunknownRouteResolver = options.unknownRouteResolver || resolveUnknownRoutes;\n\t\t\tdefaultRoute = options.defaultRoute || null;\n\n\t\t\t// Set up the window popstate and hashchange event listeners\n\t\t\tif (window.addEventListener) {\n\t\t\t\twindow.addEventListener('popstate', popstateHashchangeEventLisener, false);\n\t\t\t\twindow.addEventListener('hashchange', popstateHashchangeEventLisener, false);\n\t\t\t} else {\n\t\t\t\t// IE 8 and lower\n\t\t\t\twindow.attachEvent('popstate', popstateHashchangeEventLisener); // In case pushState has been polyfilled\n\t\t\t\twindow.attachEvent('onhashchange', popstateHashchangeEventLisener);\n\t\t\t}\n\n\t\t\t// Call loadCurrentRoute on every statechange event\n\t\t\tif (options.loadCurrentRouteOnStateChange !== false) {\n\t\t\t\trouter.on('statechange', function () {\n\n\t\t\t\t\tif (ignoreHashChangeOnce) {\n\t\t\t\t\t\t// Ensure future hashchange events are not ignored\n\t\t\t\t\t\tignoreHashChangeOnce = false;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar options = {};\n\t\t\t\t\trouter.loadCurrentRoute(options);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Fire the initial statechange event\n\t\t\tif (options.fireInitialStateChange !== false) {\n\t\t\t\trouter.fire('statechange');\n\t\t\t}\n\n\t\t\treturn router;\n\t\t},\n\t\t//routes: {},\n\t\t// router.activeRoute - A reference to the active route\n\t\tactiveRoute: {},\n\t\t// router.addRoutes(routes) - Register routes\n\t\t//\n\t\t// This will add the routes to the existing routes. Specifying a route with the same name as an existing route will\n\t\t// overwrite the previous route with the new one.\n\t\t//\n\t\t// Example\n\t\t// router.addRoutes({\n\t\t//   home: {path: '/', moduleId: 'home/homeView'},\n\t\t//   customer: {path: '/customer/:id', moduleId: 'customer/customerView'},\n\t\t//   notFound: {path: '*', moduleId: 'notFound/notFoundView'}\n\t\t// })\n\t\taddRoutes: function (routes) {\n\t\t\tfor (var key in routes) {\n\t\t\t\tif (routes.hasOwnProperty(key)) {\n\t\t\t\t\trouter.addRoute(routes[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn router;\n\t\t},\n\t\taddRoute: function (route) {\n\t\t\troutes.push(route);\n\n\t\t\tif (route.moduleId == null) {\n\t\t\t\tif (route.ctrl == null) {\n\t\t\t\t\tthrow new Error(\"route must have a ctrl or moduleId defined!\");\n\t\t\t\t}\n\n\t\t\t\troute.moduleId = route.ctrl.id;\n\t\t\t}\n\t\t\trouter.addRouteByPath(route);\n\t\t\treturn router;\n\t\t},\n\t\taddRouteAt: function (index, route) {\n\t\t\troutes.splice(index, 0, route);\n\t\t\trouter.addRouteByPath(route);\n\t\t\treturn router;\n\t\t},\n\t\taddRouteByPath: function (route) {\n\t\t\troutesByPath[route.moduleId] = route.path;\n\t\t},\n\t\tgetRoutes: function () {\n\t\t\treturn routes;\n\t\t},\n\t\tgetRoutesByPath: function () {\n\t\t\treturn routesByPath;\n\t\t},\n\t\t// router.on(eventName, eventHandler([arg1, [arg2]]) {}) - Register an event handler\n\t\t//\n\t\t// The two main events are 'statechange' and 'routeload'.\n\t\ton: function on(eventName, eventHandler) {\n\t\t\tif (typeof (eventHandlers[eventName]) === 'undefined')\n\t\t\t\teventHandlers[eventName] = [];\n\t\t\teventHandlers[eventName].push(eventHandler);\n\t\t\treturn router;\n\t\t},\n\t\t// router.fire(eventName, [arg1, [arg2]]) - Fire an event\n\t\t//\n\t\t// This will call all eventName event handlers with the arguments passed in.\n\t\tfire: function fire(eventName) {\n\t\t\tif (eventHandlers[eventName]) {\n\t\t\t\tvar eventArguments = Array.prototype.slice.call(arguments, 1);\n\t\t\t\tfor (var i = 0; i < eventHandlers[eventName].length; i++) {\n\t\t\t\t\teventHandlers[eventName][i].apply(router, eventArguments);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn router;\n\t\t},\n\t\t// router.off(eventName, eventHandler) - Remove an event handler\n\t\t//\n\t\t// If you want remove an event handler you need to keep a reference to it so you can tell router.off() with the\n\t\t// original event handler.\n\t\toff: function off(eventName, eventHandler) {\n\t\t\tif (eventHandlers[eventName]) {\n\t\t\t\tvar eventHandlerIndex = eventHandlers[eventName].indexOf(eventHandler);\n\t\t\t\tif (eventHandlerIndex !== -1) {\n\t\t\t\t\teventHandlers[eventName].splice(eventHandlerIndex, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn router;\n\t\t},\n\t\tgo: function (options) {\n\t\t\tvar ctrl = options.ctrl;\n\t\t\tif (ctrl == null) {\n\t\t\t\tthrow new Error(\"router.go() requires a 'ctrl' passed as an option !\");\n\t\t\t}\n\t\t\tvar moduleId = ctrl.id;\n\t\t\toptions.args = options.args || {};\n\t\t\toptions.routeParams = options.routeParams || {};\n\n\t\t\tif (options.updateRoute === false) {\n\t\t\t\tvar tempRoute = {};\n\t\t\t\ttempRoute.moduleId = moduleId;\n\t\t\t\ttempRoute.ctrl = ctrl;\n\t\t\t\toptions.route = tempRoute;\n\n\t\t\t\tvar newHash = router.hashPath(currentHash);\n\t\t\t\tnewHash = appendHashParams(newHash, options.routeParams);\n\t\t\t\tsetIgnoreHashChangeOnce(newHash);\n\t\t\t\trouter.setHash(newHash);\n\t\t\t\trouter.loadModule(options);\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tvar route = null;\n\n\t\t\t//var currentPath = router.urlPath(window.location.href);\n\t\t\tvar ctrlRoutes = router.findRoutesForCtrl(ctrl);\n\t\t\tfor (var i = 0; i < ctrlRoutes.length; i++) {\n\t\t\t\tvar testRoute = ctrlRoutes[i];\n\t\t\t\tvar match = router.testCtrlRoute(testRoute.path, options.routeParams);\n\t\t\t\tif (match) {\n\t\t\t\t\troute = testRoute;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (route == null) {\n\t\t\t\tconsole.error(\"No route matched request to Controller '\" + ctrl.id + \"'! Available routes for this controller: \");\n\t\t\t\tfor (var i = 0; i < ctrlRoutes.length; i++) {\n\t\t\t\t\tvar debugRoute = ctrlRoutes[i];\n\t\t\t\t\tconsole.error(\"    \", debugRoute.path);\n\t\t\t\t}\n\t\t\t\tconsole.error(\"RouteParams used to match available Controller routes:\", options.routeParams);\n\t\t\t}\n\n\t\t\t// Set routePath, if route is null use moduleId\n\t\t\tvar routePath = route != null ? route.path : moduleId;\n\n\t\t\t// TODO instead of throwing error for unsupported paths, we could remove the hash from the url and still render the Controller\n\t\t\tif (routePath instanceof RegExp) {\n\t\t\t\tthrow new Error(\"Cannot route to controller '\" + ctrl.id + \"' since it's route path is a RegExp '\" + routePath + \"'\");\n\t\t\t}\n\n\t\t\tif (routePath.indexOf('*') !== -1) {\n\t\t\t\tthrow new Error(\"Cannot route to controller '\" + ctrl.id + \"' since it's route path contains wildcards '*'. The given route for the controller is '\" + routePath + \"'\");\n\t\t\t}\n\n\t\t\tvar routeQueryParams = {};\n\n\t\t\t// Extract query params from route\n\t\t\tif (routePath.indexOf('?') !== -1) {\n\t\t\t\tvar routeQueryParamsStr = router.queryString(routePath);\n\t\t\t\tif (routeQueryParamsStr.length > 0) {\n\t\t\t\t\trouteQueryParams = router.parseRouteQueryParams(routeQueryParamsStr);\n\t\t\t\t}\n\t\t\t\t// TODO we must build up the route dynamically. Next parse the path segments!\n\t\t\t\troutePath = routePath.substr(0, routePath.indexOf('?'));\n\t\t\t}\n\n\t\t\tvar newHash = '';\n\t\t\tvar routeParams = options.routeParams;\n\n\t\t\t//propertyTypeEdit/:name?id&ok\n\t\t\tvar routePathSegments = routePath.split('/');\n\n\t\t\t// Check and append each path segment\n\t\t\tfor (var key in routePathSegments) {\n\t\t\t\tif (routePathSegments.hasOwnProperty(key)) {\n\t\t\t\t\tvar routePathSegment = routePathSegments[key];\n\n\t\t\t\t\t// Check if routePathSegment is a parameter like ':id'\n\t\t\t\t\tif (routePathSegment.charAt(0) === ':') {\n\t\t\t\t\t\tvar routePathKey = routePathSegment.substr(1);\n\n\t\t\t\t\t\t// Ensure the url has a valid value for the matching segment\n\t\t\t\t\t\t// Ensure value is not null or empty\n\t\t\t\t\t\tvar routeParamValue = routeParams[routePathKey];\n\n\t\t\t\t\t\tif (routeParamValue == null || routeParamValue === '') {\n\t\t\t\t\t\t\tthrow new Error(\"Cannot route to controller '\" + ctrl.id + \"' since it's route requires the path parameter '\"\n\t\t\t\t\t\t\t\t\t+ routePathKey + \"' but the only params provided are '\" + JSON.stringify(routeParams) + \"'\");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnewHash = newHash + '/' + routeParamValue;\n\n\t\t\t\t\t\t// We have added the routeParam value. Delete the route parameter so it is not included in the query parameters below\n\t\t\t\t\t\tdelete routeParams[routePathKey];\n\n\t\t\t\t\t\t// continue and check the other segments\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// This is a normal path segment, so append to newHash\n\t\t\t\t\t\tnewHash = newHash + '/' + routePathSegment;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// strip leading '/' if present\n\t\t\tif (newHash.indexOf('/') === 0) {\n\t\t\t\tnewHash = newHash.substr(1);\n\t\t\t}\n\n\t\t\t// add parameters to newHash\n\n\t\t\t// Check that the expected route query params are present in the passed in route params\n\t\t\tfor (var routeParamKey in routeQueryParams) {\n\t\t\t\tif (routeQueryParams.hasOwnProperty(routeParamKey)) {\n\t\t\t\t\tif (routeParams == null) {\n\t\t\t\t\t\t// The route specifies a query param but no routeParams was provided\n\t\t\t\t\t\tthrow new Error(\"Cannot route to controller '\" + ctrl.id + \"' since it's route requires the query parameter '\"\n\t\t\t\t\t\t\t\t+ routeParamKey + \"' but no routeParams was provided\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar routeParamValue = routeParams[routeParamKey];\n\t\t\t\t\t\tif (routeParamValue === undefined) {\n\t\t\t\t\t\t\t// TODO test this scenario\n\t\t\t\t\t\t\tthrow new Error(\"Cannot route to controller '\" + ctrl.id + \"' since it's route requires the query parameter '\"\n\t\t\t\t\t\t\t\t\t+ routeParamKey + \"' but the only routeParams provided are '\" + JSON.stringify(routeParams) + \"'\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnewHash = appendHashParams(newHash, routeParams);\n\n\t\t\tsetIgnoreHashChangeOnce(newHash);\n\n\t\t\trouter.setHash(newHash);\n\t\t\t//router.fire('routeload', options);\n\t\t\trouter.loadCurrentRoute(options);\n\t\t\t//}\n\t\t},\n\t\tsetHash: function (hash) {\n\t\t\twindow.location.hash = hash;\n\t\t\t//currentHash = router.getHash(); TODO this line might be required\n\t\t},\n\t\tgetHash: function () {\n\t\t\t// This method might be overkill if we support only IE9 and up\n\t\t\tvar index = window.location.href.indexOf('#');\n\t\t\tvar hash = (index == -1 ? '' : window.location.href.substr(index + 1));\n\t\t\tif (hash.indexOf('!') == 0) {\n\t\t\t\thash = hash.substr(1);\n\t\t\t}\n\t\t\treturn hash;\n\t\t},\n\t\tfindRoutesForCtrl: function (module) {\n\t\t\tvar result = [];\n\t\t\tvar moduleId = module.id;\n\t\t\tfor (var i = 0; i < routes.length; i++) {\n\n\t\t\t\tvar route = routes[i];\n\t\t\t\tif (moduleId == null || route.moduleId == null) {\n\t\t\t\t\tif (module === route.ctrl) {\n\t\t\t\t\t\tresult.push(route);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tif (moduleId === route.moduleId) {\n\t\t\t\t\t\tresult.push(route);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\ttestCtrlRoute: function (routePath, viewParams) {\n\n\t\t\tvar routeParams = router.parseRouteParams(routePath);\n\n\t\t\tfor (var key in routeParams) {\n\t\t\t\tif (routeParams.hasOwnProperty(key)) {\n\n\t\t\t\t\tif (viewParams.hasOwnProperty(key)) {\n\t\t\t\t\t\t// The routeParam has a coresponding view parameter\n\t\t\t\t\t\t// Ensure the view parameter has a value if it is a segment parameter\n\t\t\t\t\t\tvar routeParamValue = routeParams[key];\n\t\t\t\t\t\tif (routeParamValue.segment === true) {\n\t\t\t\t\t\t\tvar viewParamValue = viewParams[key];\n\t\t\t\t\t\t\tif (viewParamValue == null || viewParamValue == '') {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If any of the routeParams is missing from the viewParams, it is not a match\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// If we get here all route parameters are present in view parameters and segment parameters have a value\n\t\t\treturn true;\n\t\t},\n\t\t// router.loadCurrentRoute() - Manually tell the router to load the module for the current route\n\t\tloadCurrentRoute: function (options) {\n\t\t\toptions = options || {};\n\n\t\t\tvar routeToLoad = null;\n\t\t\tfor (var i = 0; i < routes.length; i++) {\n\t\t\t\t//for (var i in routes) {\n\t\t\t\t//if (routes.hasOwnProperty(i)) {\n\t\t\t\tvar route = routes[i];\n\n\t\t\t\toptions.route = route;\n\t\t\t\t// TODO: Should speed up lookup of routes to a map?\n\t\t\t\tif (router.testRoute(options)) {\n\t\t\t\t\t// This is the first route to match the current URL\n\t\t\t\t\trouteToLoad = route;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t//}\n\t\t\t}\n\n\t\t\tif (routeToLoad == null || routeToLoad.path === '*') {\n\t\t\t\t// No route found for url, check if new route should be created\n\t\t\t\toptions.route = routeToLoad;\n\t\t\t\trouter.handleUnknownRoute(options);\n\t\t\t\treturn router;\n\t\t\t}\n\n\t\t\tif (routeToLoad != null) {\n\t\t\t\toptions.route = routeToLoad;\n\t\t\t\trouter.loadModule(options);\n\t\t\t}\n\n\t\t\treturn router;\n\t\t},\n\t\thandleUnknownRoute: function (options) {\n\n\t\t\tvar routeOrPromise = unknownRouteResolver(options.route);\n\n\t\t\tif (utils.isPromise(routeOrPromise)) {\n\n\t\t\t\trouteOrPromise.then(function (newRoute) {\n\n\t\t\t\t\toptions.route = newRoute;\n\t\t\t\t\trouter.loadUnknownRoute(options);\n\n\t\t\t\t}, function () {\n\t\t\t\t\t// Rejected. try and load the route that was found previously which is probably the '*' mapping.\n\t\t\t\t\tif (options.route != null) {\n\t\t\t\t\t\trouter.loadModule(options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\toptions.route = routeOrPromise;\n\t\t\t\trouter.loadUnknownRoute(options);\n\t\t\t}\n\t\t\treturn router;\n\t\t},\n\t\tloadUnknownRoute: function (options) {\n\t\t\toptions = options || {};\n\t\t\tif (options.route != null) {\n\t\t\t\tif (options.route.moduleId == null || options.route.path == null) {\n\t\t\t\t\tthrow new Error(\"unknownRouteResolver must return a route object with a valid moduleId and path or a promise that resolves to a route object!\");\n\t\t\t\t}\n\t\t\t\toptions.route.isNew = true;\n\t\t\t\trouter.loadModule(options);\n\t\t\t}\n\t\t\treturn router;\n\t\t},\n\t\tloadModule: function (options) {\n\t\t\toptions = options || {};\n\t\t\t// Replace router.activeRoute with this route\n\t\t\tvar route = options.route;\n\n\t\t\trouter.activeRoute.active = false;\n\t\t\troute.active = true;\n\t\t\trouter.activeRoute = route;\n\n\t\t\t// Load the route's module\n\t\t\tconsole.log(\"route\", route);\n\n\t\t\tif (route.ctrl == null) {\n\n\t\t\t\trequire([route.moduleId], function (module) {\n\n\t\t\t\t\trouter.processLoadedModule(options, module, route);\n\n\t\t\t\t}, function () {\n\t\t\t\t\t//console.error(arguments);\n\t\t\t\t});\n\n\t\t\t} else {\n\t\t\t\trouter.processLoadedModule(options, route.ctrl, route);\n\n\n\t\t\t}\n\n\t\t},\n\t\t// urlPath(url) - Parses the url to get the path\n\t\t//\n\t\t// This will return the hash path if it exists or return the real path if no hash path exists.\n\t\t//\n\t\t// Example URL = 'http://domain.com/other/path?queryParam3=false#/example/path?queryParam1=true&queryParam2=example%20string'\n\t\t// path = '/example/path'\n\t\t//\n\t\t// Note: The URL must contain the protocol like 'http(s)://'\n\t\turlPath: function (url) {\n\t\t\t//console.log(\"URL\", url);\n\t\t\t// Check the cache to see if we've already parsed this URL\n\t\t\tif (typeof (cachedUrlPaths[url]) !== 'undefined') {\n\t\t\t\treturn cachedUrlPaths[url];\n\t\t\t}\n\n\t\t\t// The relative URI is everything after the third slash including the third slash\n\t\t\t// Example relativeUri = '/other/path?queryParam3=false#/example/path?queryParam1=true&queryParam2=example%20string'\n\t\t\tvar splitUrl = url.split('/');\n\t\t\tvar relativeUri = '/' + splitUrl.splice(3, splitUrl.length - 3).join('/');\n\n\t\t\t// The path is everything in the relative URI up to the first ? or #\n\t\t\t// Example path = '/other/path'\n\t\t\tvar path = relativeUri.split(/[\\?#]/)[0];\n\n\t\t\t// The hash is everything from the first # up to the the search starting with ? if it exists\n\t\t\t// Example hash = '#/example/path'\n\t\t\tvar hashIndex = relativeUri.indexOf('#');\n\t\t\tvar isHashEmpty = hashIndex === relativeUri.length - 1;\n\n\t\t\tif (hashIndex !== -1 && !isHashEmpty) {\n\t\t\t\tvar hash = relativeUri.substring(hashIndex).split('?')[0];\n\t\t\t\tif (hash.substring(0, 2) === '#!') {\n\t\t\t\t\t// Hashbang path\n\t\t\t\t\tpath = hash.substring(2);\n\t\t\t\t} else {\n\t\t\t\t\t// Hash path\n\t\t\t\t\tpath = hash.substring(1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Cache the path for this URL\n\t\t\tcachedUrlPaths[url] = path;\n\n\t\t\treturn path;\n\t\t},\n\t\tprocessLoadedModule: function (options, module, route) {\n\n\t\t\t// Register newly discovered routes\n\t\t\tif (route.isNew) {\n\t\t\t\tdelete route.isNew;\n\t\t\t\trouter.addRouteAt(0, route);\n\t\t\t}\n\t\t\t// Make sure this is still the active route from when loadCurrentRoute was called. The asynchronous nature\n\t\t\t// of AMD loaders means we could have fireed multiple hashchanges or popstates before the AMD module finished\n\t\t\t// loading. If we navigate to route /a then navigate to route /b but /b finishes loading before /a we don't\n\t\t\t// want /a to be rendered since we're actually at route /b.\n\t\t\tif (route.active) {\n\n\t\t\t\t// Check if routeParams has been cached for this request, otherwise cache it for this request in the options\n\t\t\t\tvar urlParams = options.urlParams;\n\t\t\t\tif (urlParams == null) {\n\t\t\t\t\turlParams = router.routeArguments(route, window.location.href);\n\t\t\t\t\toptions.urlParams = urlParams;\n\t\t\t\t}\n\t\t\t\tvar routerOptions = {\n\t\t\t\t\trouteParams: urlParams,\n\t\t\t\t\tmodule: module,\n\t\t\t\t\targs: options.args,\n\t\t\t\t\troute: route\n\t\t\t\t};\n\t\t\t\trouter.fire('routeload', routerOptions);\n\t\t\t}\n\t\t},\n\t\t// router.testRoute(route, [url]) - Test if the route matches the current URL\n\t\t//\n\t\t// This algorithm tries to fail or succeed as quickly as possible for the most common cases.\n\t\ttestRoute: function (options) {\n\n\t\t\t// Example path = '/example/path'\n\t\t\t// Example route: `exampleRoute: {path: '/example/*', moduleId: 'example/exampleView'}`\n\t\t\tvar urlPath = router.urlPath(options.url || window.location.href);\n\t\t\tvar routePath = options.route.path;\n\n\t\t\t// If the path is an exact match then the route is a match\n\t\t\tif (routePath === urlPath) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// If the path is '*' then the route is a match\n\t\t\tif (routePath === '*') {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Test if it's a regular expression\n\t\t\tif (routePath instanceof RegExp) {\n\t\t\t\treturn routePath.test(urlPath);\n\t\t\t}\n\n\t\t\t// Look for wildcards\n\t\t\tif (routePath.indexOf('*') === -1 && routePath.indexOf(':') === -1 && routePath.indexOf('?') === -1) {\n\t\t\t\t// No wildcards or parameters and we already made sure it wasn't an exact match so the test fails\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Example pathSegments = ['', example', 'path']\n\t\t\tvar urlPathSegments = urlPath.split('/');\n\n\t\t\t// Chop off any query parameters (everything after and including ?) from the routePath\n\t\t\tvar routePathQuestionIndex = routePath.indexOf('?');\n\t\t\t// Check if there is a ? but that the ? is not the last character\n\t\t\tif (routePathQuestionIndex !== -1 && routePathQuestionIndex !== routePath.length - 1) {\n\t\t\t\troutePath = routePath.substr(0, routePathQuestionIndex);\n\t\t\t}\n\n\t\t\t// Example routePathSegments = ['', 'example', '*']\n\t\t\tvar routePathSegments = routePath.split('/');\n\n\t\t\t// There must be the same number of path segments or it isn't a match\n\t\t\tif (urlPathSegments.length !== routePathSegments.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Check equality of each path segment\n\t\t\tfor (var key in routePathSegments) {\n\t\t\t\tif (routePathSegments.hasOwnProperty(key)) {\n\t\t\t\t\t// The path segments must be equal, be a wildcard segment '*', or be a path parameter like ':id'\n\t\t\t\t\tvar routePathSegment = routePathSegments[key];\n\t\t\t\t\tvar urlPathSegment = urlPathSegments[key];\n\n\t\t\t\t\t// Check if routePathSegment is the same string as the urlPathSegment or the routePathSegment is a wildcard or parameter\n\t\t\t\t\tif (routePathSegment === '*' || routePathSegment.charAt(0) === ':') {\n\t\t\t\t\t\t// This is a valid segment\n\n\t\t\t\t\t\t// Ensure the url has a valid value for the matching segment\n\t\t\t\t\t\t// Ensure value is not null or empty\n\t\t\t\t\t\tif (urlPathSegment == null || urlPathSegment === '') {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// continue and check the other segments\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (routePathSegment !== urlPathSegment) {\n\t\t\t\t\t\t\t// Not a valid segment so the url does not match the route\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If we get here the url path segments matches the route path segments. Next we check the query parameters, if there are any\n\t\t\tif (routePathQuestionIndex !== -1) {\n\t\t\t\tvar routeQueryParamsStr = options.route.path.substr(routePathQuestionIndex + 1);\n\n\t\t\t\tvar routeParams = router.parseRouteQueryParams(routeQueryParamsStr);\n\n\t\t\t\t// The url path segments match but the route also specifies query params we need to check\n\n\t\t\t\t// Extract params from url\n\t\t\t\tif (options.urlParams == null) {\n\t\t\t\t\tvar tempParams = router.routeArguments(options.route, window.location.href);\n\t\t\t\t\toptions.urlParams = tempParams;\n\t\t\t\t}\n\n\t\t\t\tfor (var key in routeParams) {\n\t\t\t\t\tif (routeParams.hasOwnProperty(key)) {\n\t\t\t\t\t\tvar urlParamValue = options.urlParams[key];\n\n\t\t\t\t\t\tif (urlParamValue == null) {\n\t\t\t\t\t\t\t// There is no parameter in the url for the routeParameter so we do not have a match\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Nothing failed. The route matches the URL.\n\t\t\treturn true;\n\t\t},\n\t\t// router.routeArguments([route, [url]]) - Gets the path variables and query parameter values from the URL\n\t\t//\n\t\t// Both parameters are optional.\n\t\trouteArguments: function (route, url) {\n\n\t\t\t/*\n\t\t\t var cacheResult = getCachedRouteArguments(route, url);\n\t\t\t if (cacheResult != null) {\n\t\t\t \n\t\t\t return cacheResult;\n\t\t\t }*/\n\n\t\t\t//argumentsCache[];\n\t\t\tif (!route)\n\t\t\t\troute = router.activeRoute;\n\t\t\tif (!url)\n\t\t\t\turl = window.location.href;\n\t\t\tvar args = {};\n\t\t\tvar urlPath = router.urlPath(url);\n\n\t\t\t// Example pathSegments = ['', example', 'path']\n\t\t\tvar urlPathSegments = urlPath.split('/');\n\n\t\t\t// Example routePathSegments = ['', 'example', '*']\n\t\t\tvar routePathSegments = [];\n\t\t\tif (route && route.path && !(route.path instanceof RegExp)) {\n\t\t\t\troutePathSegments = route.path.split('/');\n\t\t\t}\n\n\t\t\t// Get path variables\n\t\t\t// URL '/customer/123'\n\t\t\t// and route `{path: '/customer/:id'}`\n\t\t\t// gets id = '123'\n\t\t\tfor (var routeSegmentIndex in routePathSegments) {\n\t\t\t\tif (routePathSegments.hasOwnProperty(routeSegmentIndex)) {\n\t\t\t\t\tvar routeSegment = routePathSegments[routeSegmentIndex];\n\t\t\t\t\tif (routeSegment.charAt(0) === ':') {\n\t\t\t\t\t\trouteSegment = routeSegment.substring(1);\n\t\t\t\t\t\t// Strip everything after and including ? if present\n\t\t\t\t\t\tvar questionmarkIndex = routeSegment.indexOf('?');\n\t\t\t\t\t\tif (questionmarkIndex !== -1) {\n\t\t\t\t\t\t\trouteSegment = routeSegment.substr(0, questionmarkIndex);\n\t\t\t\t\t\t}\n\t\t\t\t\t\targs[routeSegment] = urlPathSegments[routeSegmentIndex];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//get query string\n\t\t\tvar search = router.queryString(url);\n\t\t\tvar queryParams = router.queryParamsFromSearchString(search);\n\t\t\tfor (var param in queryParams) {\n\t\t\t\tif (queryParams.hasOwnProperty(param)) {\n\t\t\t\t\targs[param] = queryParams[param];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Parse the arguments into unescaped strings, numbers, or booleans\n\t\t\targs = router.parseArguments(args);\n\n\t\t\t//setCachedRouteArguments(route, url, args);\n\t\t\treturn args;\n\t\t},\n\t\tqueryString: function (url) {\n\t\t\t// Get the query string from the url\n\t\t\t// The query string is the query parameters excluding the leading '?'\n\t\t\tvar searchIndex = url.indexOf('?');\n\t\t\tvar search = '';\n\t\t\tif (searchIndex !== -1) {\n\t\t\t\tsearch = url.substring(searchIndex + 1);\n\t\t\t\tvar hashIndex = search.indexOf('#');\n\t\t\t\tif (hashIndex !== -1) {\n\t\t\t\t\tsearch = search.substring(0, hashIndex);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// TODO only check url once to extract params, not twice once for url and again for hash\n\t\t\t// If it's a hash URL we need to get the search from the hash\n\t\t\tvar hashPathIndex = url.indexOf('#');\n\t\t\tvar hashBangPathIndex = url.indexOf('#!');\n\t\t\tif (hashPathIndex !== -1 || hashBangPathIndex !== -1) {\n\t\t\t\tvar hash = '';\n\t\t\t\tif (hashPathIndex !== -1) {\n\t\t\t\t\thash = url.substring(hashPathIndex);\n\t\t\t\t} else {\n\t\t\t\t\thash = url.substring(hashBangPathIndex);\n\t\t\t\t}\n\t\t\t\tsearchIndex = hash.indexOf('?');\n\t\t\t\tif (searchIndex !== -1) {\n\t\t\t\t\tsearch = hash.substring(searchIndex + 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn search;\n\t\t},\n\t\tqueryParams: function (url) {\n\t\t\tvar search = router.queryString(url);\n\t\t\tvar queryParams = router.queryParamsFromSearchString(search);\n\t\t\treturn queryParams;\n\t\t},\n\t\tqueryParamsFromSearchString: function (search) {\n\t\t\tvar params = {};\n\t\t\tvar queryParameters = search.split('&');\n\t\t\t// split() on an empty string has a strange behavior of returning [''] instead of []\n\t\t\tif (queryParameters.length === 1 && queryParameters[0] === '') {\n\t\t\t\tqueryParameters = [];\n\t\t\t}\n\t\t\tfor (var i in queryParameters) {\n\t\t\t\tif (queryParameters.hasOwnProperty(i)) {\n\t\t\t\t\tvar queryParameter = queryParameters[i];\n\t\t\t\t\tvar queryParameterParts = queryParameter.split('=');\n\t\t\t\t\tvar value = queryParameterParts.splice(1, queryParameterParts.length - 1).join('=');\n\t\t\t\t\tparams[queryParameterParts[0]] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn params;\n\t\t},\n\t\tparseArguments: function (args) {\n\t\t\tfor (var arg in args) {\n\t\t\t\tvar value = args[arg];\n\t\t\t\tif (value === 'true') {\n\t\t\t\t\targs[arg] = true;\n\t\t\t\t} else if (value === 'false') {\n\t\t\t\t\targs[arg] = false;\n\t\t\t\t} else if (!isNaN(value) && value !== '' && value.charAt(0) !== '0') {\n\t\t\t\t\t// numeric\n\t\t\t\t\targs[arg] = +value;\n\t\t\t\t} else {\n\t\t\t\t\t// string\n\t\t\t\t\targs[arg] = decodeURIComponent(value);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn args;\n\t\t},\n\t\tparseRouteQueryParams: function (routerQueryParams) {\n\n\t\t\tvar hit = cachedRouterQueryParams[routerQueryParams];\n\t\t\tif (hit != null) {\n\t\t\t\treturn hit;\n\t\t\t}\n\n\t\t\tvar routeParams = {};\n\t\t\tvar routeQueryParameters = routerQueryParams.split('&');\n\t\t\t// split() on an empty string has a strange behavior of returning [''] instead of []\n\t\t\tif (routeQueryParameters.length === 1 && routeQueryParameters[0] === '') {\n\t\t\t\trouteQueryParameters = [];\n\t\t\t}\n\t\t\tfor (var key in routeQueryParameters) {\n\t\t\t\tif (routeQueryParameters.hasOwnProperty(key)) {\n\t\t\t\t\tvar routeQueryParameter = routeQueryParameters[key];\n\t\t\t\t\trouteParams[routeQueryParameter] = {query: true};\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Cache result\n\t\t\tcachedRouterQueryParams[routerQueryParams] = routeParams;\n\n\t\t\treturn routeParams;\n\t\t},\n\t\tparseRouteParams: function (path) {\n\t\t\tvar hit = cachedRouterParams[path];\n\t\t\tif (hit != null) {\n\t\t\t\treturn hit;\n\t\t\t}\n\n\t\t\tvar routePath = path;\n\t\t\tvar routeParams = {};\n\n\t\t\tif (routePath == null || routePath == '') {\n\t\t\t\treturn routeParams;\n\t\t\t}\n\n\t\t\t// Test if it's a regular expression\n\t\t\tif (routePath instanceof RegExp) {\n\t\t\t\troutePath = routePath.toString();\n\t\t\t\t// Remove slashes from beginning and end\n\t\t\t\troutePath = routePath.substring(1, routePath.length - 1);\n\t\t\t}\n\n\n\t\t\tif (routePath.indexOf(':') === -1 && routePath.indexOf('?') !== -1) {\n\t\t\t\t// No parameters in routePath\n\t\t\t\tcachedRouterParams[path] = routeParams;\n\t\t\t\treturn routeParams;\n\t\t\t}\n\n\t\t\t// Chop off any query parameters (everything after and including ?) from the routePath\n\t\t\tvar routePathQuestionIndex = routePath.indexOf('?');\n\t\t\t// Check if there is a ? but that the ? is not the last character\n\t\t\tif (routePathQuestionIndex !== -1 && routePathQuestionIndex !== routePath.length - 1) {\n\t\t\t\t// Remove query parms\n\t\t\t\troutePath = routePath.substr(0, routePathQuestionIndex);\n\t\t\t}\n\n\t\t\t// Parse segment parameters eg ':id'\n\t\t\t// Example routePathSegments = ['foo', 'bar', ':id', '']\n\t\t\tvar routePathSegments = routePath.split('/');\n\n\t\t\tfor (var key in routePathSegments) {\n\t\t\t\tif (routePathSegments.hasOwnProperty(key)) {\n\t\t\t\t\t// The path segments must be equal, be a wildcard segment '*', or be a path parameter like ':id'\n\t\t\t\t\tvar routePathSegment = routePathSegments[key];\n\n\t\t\t\t\t// Check if routePathSegment is a segment dparameter\n\t\t\t\t\tif (routePathSegment.charAt(0) === ':') {\n\t\t\t\t\t\tvar param = routePathSegment.slice(1);\n\t\t\t\t\t\trouteParams[param] = {segment: true};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Parse query string parameters eg ?id&name\n\t\t\tif (routePathQuestionIndex !== -1) {\n\t\t\t\tvar routeQueryParamsStr = path.substr(routePathQuestionIndex + 1);\n\n\t\t\t\tvar routeQueryParams = router.parseRouteQueryParams(routeQueryParamsStr);\n\t\t\t\trouteParams = $.extend(routeParams, routeQueryParams);\n\t\t\t}\n\t\t\tcachedRouterParams[path] = routeParams;\n\t\t\treturn routeParams;\n\t\t},\n\t\thashPath: function (hash) {\n\t\t\t// Remove leading #\n\t\t\tif (hash.indexOf('#') === 0) {\n\t\t\t\thash = hash.substring(1);\n\t\t\t}\n\n\t\t\t// Remove everything after the ?\n\t\t\tvar idx = hash.indexOf('?');\n\t\t\tif (idx >= 0) {\n\t\t\t\thash = hash.substring(0, idx);\n\t\t\t}\n\n\t\t\treturn hash;\n\t\t}\n\t};\n\n\tfunction resolveUnknownRoutes() {\n\t\tvar deferred = $.Deferred();\n\t\tvar promise = deferred.promise();\n\n\t\tvar hashIndex = window.location.href.indexOf('#');\n\n\t\tif (hashIndex === -1 || hashIndex === location.href.length - 1) {\n\t\t\t// no hash found or hash is at end of url and no hash part is available, so use default view\n\t\t\tif (defaultRoute == null) {\n\t\t\t\tthrow new Error(\"Couldn't resolve the url, \" + location.href + \", to a route. Please set the option 'kudu.defaultRoute' to render a default page!\");\n\t\t\t}\n\t\t\tdeferred.resolve(defaultRoute);\n\t\t\treturn promise;\n\t\t}\n\n\t\tvar path = router.urlPath(window.location.href);\n\n\t\tif (path.indexOf(\"/\") === 0) {\n\t\t\tpath = path.substr(1);\n\t\t}\n\n\t\trequire([path], function (module) {\n\t\t\tvar newRoute = {\n\t\t\t\tpath: path,\n\t\t\t\tctrl: module,\n\t\t\t\tmoduleId: path\n\t\t\t};\n\t\t\tdeferred.resolve(newRoute);\n\n\t\t}, function () {\n\t\t\tdeferred.reject();\n\n\t\t});\n\n\t\treturn promise;\n\t}\n\n\tfunction appendHashParams(hash, params) {\n\t\t// TODO check for existing params on hash\n\n\t\tif (params != null) {\n\t\t\tvar paramStr = $.param(params, true);\n\n\t\t\tif (paramStr.length > 0) {\n\n\t\t\t\tif (hash.indexOf('?') === -1) {\n\t\t\t\t\t// No existing parameters\n\t\t\t\t\thash = hash + '?' + paramStr;\n\n\t\t\t\t} else {\n\t\t\t\t\t// There are existing parameters\n\t\t\t\t\thash = hash + '&' + paramStr;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t\treturn hash;\n\t}\n\n\tfunction setIgnoreHashChangeOnce(newHash) {\n\t\tif (currentHash != newHash) {\n\t\t\tignoreHashChangeOnce = true;\n\t\t}\n\t}\n\n\t// Return the router\n\treturn router;\n});\n","define('utils/ajaxTracker',['require','jquery','./utils'],function (require) {\r\n\r\n\tvar $ = require(\"jquery\");\r\n\tvar utils = require(\"./utils\");\r\n\r\n\tfunction ajaxTracker(kudu) {\r\n\r\n\t\tif (kudu == null) {\r\n\t\t\tthrow new Error(\"ajaxTracker requires a kudu instance!\");\r\n\t\t}\r\n\r\n\t\tvar that = {};\r\n\t\tvar idCounter = 0;\r\n\t\tvar promiseCounter = 0;\r\n\r\n\t\tvar promisesMap = {};\r\n\t\tvar globalPromise = null;\r\n\t\t//var globalPromiseArgs = {};\r\n\r\n\t\tthat.add = function (target, promise, args) {\r\n\t\t\t\r\n\t\t\tif (typeof promise.abort !== 'function') {\r\n\t\t\t\tthrow new Error(\"ajaxTracker.add(promise) requires an 'abort' function for when views are cancelled!\");\r\n\t\t\t}\r\n\r\n\t\t\tvar promisesArray = promisesMap[target];\r\n\t\t\tif (promisesArray == null) {\r\n\t\t\t\tpromisesArray = [];\r\n\t\t\t\tpromisesMap[target] = promisesArray;\r\n\t\t\t}\r\n\r\n\t\t\tvar item = {promise: promise, args: args};\r\n\t\t\tpromisesArray.push(item);\r\n\r\n\t\t\tvar triggerOptions = {\r\n\t\t\t\tjqXHR: promise,\r\n\t\t\t\targs: args\r\n\t\t\t};\r\n\t\t\tif (globalPromise == null) {\r\n\t\t\t\tglobalPromise = $.when(promise);\r\n\t\t\t\t/*\r\n\t\t\t\t if (args != null) {\r\n\t\t\t\t globalPromiseArgs = $.extend({}, args);\r\n\t\t\t\t }*/\r\n\r\n\t\t\t\t$(kudu).trigger(\"global.ajax.start\", [triggerOptions]);\r\n\t\t\t\ttriggerOptions.args = args;\r\n\t\t\t\t$(kudu).trigger(\"ajax.start\", [triggerOptions]);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tglobalPromise = $.when(globalPromise, promise);\r\n\t\t\t\t/*\r\n\t\t\t\t if (args != null) {\r\n\t\t\t\t globalPromiseArgs = $.extend(globalPromiseArgs, args);\r\n\t\t\t\t }*/\r\n\t\t\t\ttriggerOptions.args = args;\r\n\t\t\t\t$(kudu).trigger(\"ajax.start\", [triggerOptions]);\r\n\t\t\t}\r\n\t\t\tglobalPromise._id = idCounter++;\r\n\r\n\t\t\taddListeners(target, globalPromise, promise, args);\r\n\t\t\t//console.log(\"DONE registering\", globalPromise._id);\r\n\r\n\t\t\tpromiseCounter++;\r\n\r\n\t\t\treturn globalPromise;\r\n\t\t};\r\n\r\n\t\tthat.remove = function (target, promise) {\r\n\t\t\tvar jqpromiseArray = promisesMap[target];\r\n\t\t\tif (jqpromiseArray == null) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tvar index = -1;\r\n\t\t\tfor (var i = 0; i < jqpromiseArray.length; i++) {\r\n\t\t\t\tvar item = jqpromiseArray[i];\r\n\t\t\t\tif (item.promise === promise) {\r\n\t\t\t\t\tindex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\tjqpromiseArray.splice(index, 1);\r\n\t\t\t\tif (jqpromiseArray.length === 0) {\r\n\t\t\t\t\tdelete promisesMap[target];\r\n\t\t\t\t}\r\n\t\t\t\tpromiseCounter--;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\tthat.clear = function (target) {\r\n\t\t\tif (arguments.length === 0) {\r\n\t\t\t\tpromisesMap = {};\r\n\r\n\t\t\t} else {\r\n\t\t\t\tdelete promisesMap[target];\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthat.abort = function (target) {\r\n\t\t\tif (arguments.length === 0) {\r\n\t\t\t\tfor (var key in promisesMap) {\r\n\t\t\t\t\tif (promisesMap.hasOwnProperty(key)) {\r\n\t\t\t\t\t\tvar promisesArray = promisesMap[key];\r\n\t\t\t\t\t\tabortItems(promisesArray);\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tabortItems(promisesArray);\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar promisesArray = promisesMap[target];\r\n\t\t\tif (promisesArray == null) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tabortItems(promisesArray);\r\n\t\t};\r\n\r\n\t\tfunction abortItems(promisesArray) {\r\n\t\t\t// promiseArray could be manipulated outside the loop below, so we make a copy\r\n\t\t\tvar promisesCopy = promisesArray.slice();\r\n\t\t\t$.each(promisesCopy, function (index, item) {\r\n\t\t\t\titem.promise.abort();\r\n\t\t\t});\r\n\t\t\tglobalPromise = null;\r\n\t\t\t//globalPromiseArgs = {};\t\t\t\r\n\t\t}\r\n\r\n\t\tfunction addListeners(target, globalPromiseParam, promiseParam, args) {\r\n\r\n\t\t\tpromiseParam.then(function (data, status, jqXHR) {\r\n\r\n\t\t\t\tvar triggerOptions;\r\n\r\n\t\t\t\tif (isXhr(jqXHR)) {\r\n\t\t\t\t\ttriggerOptions = {data: data, status: status, jqXHR: jqXHR, args: args};\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar promiseArgs;\r\n\t\t\t\t\tif (arguments.length > 0) {\r\n\t\t\t\t\t\tpromiseArgs = Array.prototype.slice.call(arguments);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttriggerOptions = {data: null, status: null, jqXHR: null, error: null, args: args, promiseArgs: promiseArgs};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(kudu).trigger(\"ajax.success\", [triggerOptions]);\r\n\r\n\t\t\t}, function (jqXHR, status, error) {\r\n\r\n\t\t\t\tvar triggerOptions;\r\n\r\n\t\t\t\tif (isXhr(jqXHR)) {\r\n\t\t\t\t\tvar triggerOptions = {error: error, status: status, jqXHR: jqXHR, args: args};\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar promiseArgs;\r\n\t\t\t\t\tif (arguments.length > 0) {\r\n\t\t\t\t\t\tpromiseArgs = Array.prototype.slice.call(arguments);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttriggerOptions = {data: null, status: null, jqXHR: null, error: null, args: args, promiseArgs: promiseArgs};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(kudu).trigger(\"ajax.error\", [triggerOptions]);\r\n\t\t\t});\r\n\r\n\t\t\tpromiseParam.always(function (dataOrjqXHR, status, errorOrjqXHR) {\r\n\t\t\t\t// Note: the promise might not be an ajax request at all!\r\n\r\n\t\t\t\tvar triggerOptions;\r\n\r\n\t\t\t\tif (isXhr(dataOrjqXHR)) {\r\n\t\t\t\t\ttriggerOptions = {data: dataOrjqXHR, status: status, jqXHR: errorOrjqXHR, error: null, args: args};\r\n\r\n\t\t\t\t} else if (isXhr(errorOrjqXHR)) {\r\n\t\t\t\t\ttriggerOptions = {data: null, status: status, jqXHR: dataOrjqXHR, error: errorOrjqXHR, args: args};\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar promiseArgs;\r\n\t\t\t\t\tif (arguments.length > 0) {\r\n\t\t\t\t\t\tpromiseArgs = Array.prototype.slice.call(arguments);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttriggerOptions = {data: null, status: null, jqXHR: null, error: null, args: args, promiseArgs: promiseArgs};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(kudu).trigger(\"ajax.complete\", [triggerOptions]);\r\n\t\t\t\tvar removed = that.remove(target, promiseParam);\r\n\t\t\t\t//console.log(\"Removed?\", removed);\r\n\t\t\t});\r\n\r\n\t\t\tglobalPromiseParam.then(function (data, status, jqXHR) {\r\n\r\n\t\t\t\tvar triggerOptions;\r\n\r\n\t\t\t\tif (isXhr(jqXHR)) {\r\n\t\t\t\t\ttriggerOptions = {data: data, status: status, jqXHR: jqXHR, args: args};\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar promiseArgs;\r\n\t\t\t\t\tif (arguments.length > 0) {\r\n\t\t\t\t\t\tpromiseArgs = Array.prototype.slice.call(arguments);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttriggerOptions = {data: null, status: null, jqXHR: null, error: null, args: args, promiseArgs: promiseArgs};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Only process if this is the globalPromise, otherwise globalPromise has been overwritten\r\n\t\t\t\tif (globalPromise == null || globalPromise == globalPromiseParam) {\r\n\r\n\t\t\t\t\t$(kudu).trigger(\"ajax.stop\", [triggerOptions]);\r\n\r\n\t\t\t\t\tdelete triggerOptions.args;\r\n\t\t\t\t\t$(kudu).trigger(\"global.ajax.stop\", [triggerOptions]);\r\n\t\t\t\t\tglobalPromise = null;\r\n\t\t\t\t\t//globalPromiseArgs = {};\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//console.log(\"globalPromise ignore then\");\r\n\t\t\t\t\t$(kudu).trigger(\"ajax.stop\", [triggerOptions]);\r\n\t\t\t\t}\r\n\r\n\t\t\t}, function (jqXHR, status, error) {\r\n\r\n\t\t\t\tvar triggerOptions;\r\n\r\n\t\t\t\tif (isXhr(jqXHR)) {\r\n\t\t\t\t\ttriggerOptions = {error: error, status: status, jqXHR: jqXHR, args: args};\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar promiseArgs;\r\n\t\t\t\t\tif (arguments.length > 0) {\r\n\t\t\t\t\t\tpromiseArgs = Array.prototype.slice.call(arguments);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttriggerOptions = {data: null, status: null, jqXHR: null, error: null, args: args, promiseArgs: promiseArgs};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (globalPromise == null || globalPromise == globalPromiseParam) {\r\n\r\n\t\t\t\t\t$(kudu).trigger(\"ajax.stop\", [triggerOptions]);\r\n\r\n\t\t\t\t\tdelete triggerOptions.args;\r\n\t\t\t\t\t$(kudu).trigger(\"global.ajax.stop\", [triggerOptions]);\r\n\t\t\t\t\tglobalPromise = null;\r\n\t\t\t\t\t//globalPromiseArgs = {};\r\n\t\t\t\t\t//console.log(\"globalPromise ERROR\", globalPromiseParam);\r\n\t\t\t\t\t//console.log(arguments);\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//console.log(\"globalPromise ignore error\");\r\n\t\t\t\t\t$(kudu).trigger(\"ajax.stop\", [triggerOptions]);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tglobalPromiseParam.always(function () {\r\n\r\n\t\t\t\tif (globalPromise == null || globalPromise == globalPromiseParam) {\r\n\t\t\t\t\t//console.log(\"globalPromise ALWAYS\", arguments);\r\n\t\t\t\t\t//console.log(\"Promises size1:\", utils.objectLength(jqXHRMap));\r\n\t\t\t\t\t//console.log(\"Promises size2:\", promiseCounter);\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//console.log(\"globalPromise ignore always\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction isXhr(xhr) {\r\n\t\t\tif (xhr != null) {\r\n\t\t\t\tif (typeof xhr.getAllResponseHeaders === 'function' && typeof xhr.abort === 'function') {\r\n\t\t\t\t\t// assume dataOrjqXHR is a jqXHR and thus an Ajax request\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn that;\r\n\t}\r\n\r\n\treturn ajaxTracker;\r\n});\n","define('utils/simpleAjaxTracker',['require'],function (require) {\n\n\tvar simpleAjaxTracker = {};\n\n\tsimpleAjaxTracker.create = function (ajaxTracker, options) {\n\t\tvar adaptor = {\n\t\t\tadd: function (jqXhr, args) {\n\t\t\t\tajaxTracker.add(options.target, jqXhr, args);\n\t\t\t},\n\t\t\tremove: function (jqXhr) {\n\t\t\t\tajaxTracker.remove(options.target, jqXhr);\n\t\t\t},\n\t\t\tabort: function () {\n\t\t\t\tajaxTracker.abort(options.target);\n\t\t\t}\n\t\t};\n\n\t\treturn adaptor;\n\t};\n\n\treturn simpleAjaxTracker;\n});\n\n","define('lifecycle/onInitHandler',['require','jquery'],function (require) {\n\n\tvar $ = require(\"jquery\");\n\n\tfunction onInitHandler(options) {\n\t\t\n\t\tvar deferred = $.Deferred();\n\t\tvar promise = deferred.promise();\n\n\t\tif (typeof options.ctrl.onInit !== 'function') {\n\t\t\tdeferred.reject(\"Controllers *must* implement an onInit method that returns either a Ractive function or a promise that resolves to a Ractive function!\");\n\t\t\treturn promise;\n\t\t}\n\n\t\tvar viewOptions = {\n\t\t\trouteParams: options.routeParams,\n\t\t\targs: options.args,\n\t\t\tajaxTracker: options.ajaxTracker\n\t\t};\n\n\t\tvar ractiveFnOrPromise = options.ctrl.onInit(viewOptions);\n\t\t\n\t\tdeferred.resolve(ractiveFnOrPromise);\n\t\t\n\t\t/*\n\t\tif (options.createView) {\n\t\t\tpromise = options.createView(options);\n\t\t} else {\n\t\t\tpromise = createView(options);\n\t\t}*/\n\n\t\treturn promise;\n\t}\n\n\treturn onInitHandler;\n});\n","define('lifecycle/onRemoveHandler',['require','jquery','../utils/utils'],function (require) {\n\n\tvar $ = require(\"jquery\");\n\tvar utils = require(\"../utils/utils\");\n\n\tfunction onRemoveHandler(options) {\n\n\t\tvar deferred = $.Deferred();\n\t\tvar promise = deferred.promise();\n\n\t\tif (typeof options.ctrl.onRemove !== 'function') {\n\t\t\tdeferred.resolve();\n\t\t\treturn promise;\n\t\t}\n\n\t\tvar viewOptions = {\n\t\t\trouteParams: options.routeParams,\n\t\t\targs: options.args,\n\t\t\tview: options.view,\n\t\t\tajaxTracker: options.ajaxTracker\n\t\t};\n\n\t\tvar booleanOrPromise = options.ctrl.onRemove(viewOptions);\n\n\t\tif (booleanOrPromise == null || booleanOrPromise == true) {\n\t\t\tdeferred.resolve();\n\t\t\treturn promise;\n\t\t}\n\n\t\tif (booleanOrPromise == false) {\n\t\t\tdeferred.reject(\"controller \" + + \"onRemove returned false\");\n\t\t\treturn promise;\n\t\t}\n\n\t\tif (utils.isPromise(booleanOrPromise)) {\n\t\t\tbooleanOrPromise.then(function (bool) {\n\n\t\t\t\t// Request could have been overwritten by new request. Ensure this is still the active request\n\t\t\t\tif (!options.mvc.requestTracker.active) {\n\t\t\t\t\tdeferred.reject(\"Request overwritten by another view request\");\n\t\t\t\t\treturn promise;\n\t\t\t\t}\n\n\t\t\t\tif (bool == null || bool == true) {\n\t\t\t\t\tdeferred.resolve();\n\t\t\t\t} else {\n\t\t\t\t\tdeferred.reject();\n\t\t\t\t}\n\t\t\t}, function () {\n\t\t\t\t// onRemove promise rejected\n\t\t\t\tdeferred.reject();\n\n\t\t\t});\n\n\t\t} else {\n\t\t\tconsole.warn(\"Ignoring new view since onRemove did not return a valid response. onRemove must return either true/false or a promise that resolves to true/false.\");\n\t\t\tdeferred.reject();\n\t\t}\n\t\treturn promise;\n\t}\n\n\treturn onRemoveHandler;\n});\n","define('ractivelib/setupEvents',['require','jquery'],function (require) {\n\n\tvar $ = require(\"jquery\");\n\n\tfunction setupEvents(options) {\n\t\t// Guard against if view is not a ractive instance\n\t\tif (!options.view.off) {\n\t\t\treturn;\n\t\t}\n\n\t\t/*\n\t\tvar triggerOptions = {\n\t\t\trouteParams: options.routeParams,\n\t\t\targs: options.args,\n\t\t\tview: options.view,\n\t\t\tctrl: options.ctrl,\n\t\t\tajaxTracker: options.ajaxTracker,\n\t\t\tmvc: options.mvc\n\t\t};\n\n\t\tvar viewOptions = {\n\t\t\trouteParams: options.routeParams,\n\t\t\targs: options.args,\n\t\t\tview: options.view,\n\t\t\tajaxTracker: options.ajaxTracker\n\t\t};*/\n\n\t\t// Add callback events\n\t\toptions.view.off('complete');\n\t\toptions.view.off('render');\n\t\toptions.view.off('unrender');\n\t\toptions.view.off('teardown');\n\n\t\toptions.view.on('complete', function () {\n\t\t\t// switch on transitions that was disabled in kudu during rendering of the view.\n\t\t\tthis.transitionsEnabled = true;\n\t\t\t/*\n\t\t\tif (typeof options.ctrl.onComplete == 'function') {\n\t\t\t\toptions.ctrl.onComplete(viewOptions);\n\t\t\t}*/\n\t\t\t//options.kudu.triggerEvent(\"complete\", triggerOptions);\n\t\t});\n\n\t\toptions.view.on('render', function () {\n\t\t\t//console.log(\"onrender\");\n\t\t\t/*\n\t\t\tif (typeof options.ctrl.onRender == 'function') {\n\t\t\t\toptions.ctrl.onRender(viewOptions);\n\t\t\t}*/\n\t\t\t//options.kudu.triggerEvent(\"render\", triggerOptions);\n\t\t});\n\n\t\toptions.view.on('unrender', function () {\n\t\t\t/*\n\t\t}\n\t\t\tif (typeof options.ctrl.onUnrender == 'function') {\n\t\t\t\toptions.ctrl.onUnrender(viewOptions);\n\t\t\t}\n\t\t\toptions.kudu.triggerEvent(\"unrender\", triggerOptions);\n\t\t\t*/\n\t\t});\n\n\t\toptions.view.on('teardown', function () {\n\t\t\t//console.log(\"onteardown\");\n\t\t\t//options.kudu.triggerEvent(\"teardown\", triggerOptions);\n\t\t});\n\n\t\tvar that = {};\n\n\n\n\t\treturn that;\n\t}\n\treturn setupEvents;\n});\n","define('ractivelib/setupDefaultEvents',['require','jquery','ractive'],function (require) {\n\n\tvar $ = require(\"jquery\");\n\tvar Ractive = require(\"ractive\");\n\n\tfunction setupDefaultEvents(options) {\n\t\tRactive.defaults.onconstruct = function () {\n\t\t\t//console.error(\"OK\", this);\n\t\t};\n\n\t\tvar that = {};\n\n\t\treturn that;\n\t}\n\treturn setupDefaultEvents;\n});\n","define('transition/fade',['require','jquery'],function (require) {\n\n\tvar $ = require(\"jquery\");\n\n\tfunction fade() {\n\n\t\tvar that = {};\n\n\t\tthat.intro = function (options, done) {\n\t\t\tvar target = options.target;\n\n\t\t\tif (target == null) {\n\t\t\t\tthrow new Error(\"options.target is not defined!\");\n\t\t\t}\n\n\t\t\tvar duration = options.duration || 'fast';\n\n\t\t\tif (options.firstView) {\n\t\t\t\tduration = 0;\n\t\t\t}\n\n\t\t\t$(options.target).fadeIn(duration, function () {\n\t\t\t\tdone();\n\t\t\t});\n\t\t};\n\n\t\tthat.outro = function (options, done) {\n\t\t\tvar target = options.target;\n\n\t\t\tif (target == null) {\n\t\t\t\tthrow new Error(\"options.target is not defined!\");\n\t\t\t}\n\n\t\t\tvar duration = options.duration || 'fast';\n\n\t\t\tif (options.firstView) {\n\t\t\t\tduration = 0;\n\t\t\t}\n\n\t\t\t$(options.target).fadeOut(duration, function () {\n\t\t\t\tdone();\n\t\t\t});\n\t\t}\n\n\t\treturn that;\n\t}\n\treturn fade();\n});\n\n\n\n","define('transition/intro',['require','jquery','./fade'],function (require) {\n\n\tvar $ = require(\"jquery\");\n\tvar fade = require(\"./fade\");\n\n\tfunction intro(options) {\n\n\t\tvar deferred = $.Deferred();\n\t\tvar promise = deferred.promise();\n\t\t\n\t\tif (options.fx !== true) {\n\t\t\tdeferred.resolve();\n\t\t\treturn promise;\n\t\t}\n\t\t\n\t\tvar transition = options.intro || fade.intro;\n\n\t\ttransition(options, deferred.resolve);\n\n\t\treturn promise;\n\t}\n\treturn intro;\n});\n","define('transition/outro',['require','jquery','./fade'],function (require) {\n\n\tvar $ = require(\"jquery\");\n\tvar fade = require(\"./fade\");\n\n\tfunction outro(options) {\n\n\t\tvar deferred = $.Deferred();\n\t\tvar promise = deferred.promise();\n\t\t\n\t\tif (options.fx !== true) {\n\t\t\tdeferred.resolve();\n\t\t\treturn promise;\n\t\t}\n\t\t\n\t\tvar transition = options.outro || fade.outro;\n\n\t\ttransition(options, deferred.resolve);\n\n\t\treturn promise;\n\t}\n\treturn outro;\n});\n","define('utils/severity',['require'],function (require) {\n\n\tfunction severity() {\n\n\t\tthis.DEBUG = 0;\n\t\tthis.INFO = 1;\n\t\tthis.WARNING = 2;\n\t\tthis.ERROR = 3;\n\t}\n\n\treturn new severity();\n});\n\n","define('ractivelib/render/create',['require','jquery','../../utils/utils','../../utils/severity'],function (require) {\n\n\tvar $ = require(\"jquery\");\n\tvar utils = require(\"../../utils/utils\");\n\tvar severity = require(\"../../utils/severity\");\n\n\tfunction create(options) {\n\n\t\tvar deferred = $.Deferred();\n\t\tvar promise = deferred.promise();\n\n\t\tif (options.viewOrPromise == null) {\n\t\t\tconsole.warn(\"Ignoring view since onInit returned null. onInit must return either a Ractive function or a promise that resolves to a Ractive function.\");\n\t\t\t// TODO how to handle errors in kudu generically?\n\t\t\tdeferred.reject({level: severity.INFO, message: \"Ignoring view since onInit returned null. onInit must return either a Ractive function or a promise that resolves to a Ractive function.\"});\n\t\t\treturn promise;\n\t\t}\n\n\t\tif (utils.isPromise(options.viewOrPromise)) {\n\n\t\t\toptions.viewOrPromise.then(function (ractiveObj) {\n\n\t\t\t\tif (typeof ractiveObj === 'function') {\n\t\t\t\t\tractiveObj = new ractiveObj();\n\t\t\t\t}\n\n\t\t\t\t// Request could have been overwritten by new request. Ensure this is still the active request\n\t\t\t\tif (!options.mvc.requestTracker.active) {\n\t\t\t\t\tdeferred.reject(\"Request overwritten by another view request\");\n\t\t\t\t\treturn promise;\n\t\t\t\t}\n\n\t\t\t\tvar view = ractiveObj;\n\t\t\t\tdeferred.resolve(view);\n\n\t\t\t}, function () {\n\t\t\t\tif (!options.mvc.requestTracker.active && arguments.length === 0) {\n\t\t\t\t\tdeferred.reject(\"Request overwritten by another view request\");\n\t\t\t\t} else {\n\t\t\t\t\t// if the Ctrl.onInit() call rejected promise\n\t\t\t\t\tdeferred.reject.apply(deferred, arguments);\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t} else if ($.isFunction(options.viewOrPromise)) {\n\t\t\t// Assume it is a Ractive function\n\t\t\t// Should this scenrio be supported? How will the view receive an instance to the ractive\n\t\t\t//options.kudu.createRactive(RactiveFnOrPromise);\n\t\t\tvar view = new options.viewOrPromise();\n\t\t\tdeferred.resolve(view);\n\n\t\t} else if (utils.isRactiveObject(options.viewOrPromise)) {\n\t\t\t// Assume it is a Ractive instance\n\t\t\tvar view = options.viewOrPromise;\n\t\t\tdeferred.resolve(view);\n\n\t\t} else {\n\t\t\tconsole.warn(\"Ignoring view since onInit did not return a valid response. onInit must return either a Ractive function or a promise that resolves to a Ractive function.\");\n\t\t\tdeferred.reject(\"Ignoring view since onInit did not return a valid response. onInit must return either a Ractive function or a promise that resolves to a Ractive function.\");\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\treturn create;\n});\n","define('ractivelib/render/render',['require','jquery'],function (require) {\n\n\tvar $ = require(\"jquery\");\n\n\tfunction render(options) {\n\n\t\tvar deferred = $.Deferred();\n\t\tvar promise = deferred.promise();\n\n\t\toptions.view.transitionsEnabled = false;\n\n\t\toptions.view.render(options.target).then(function () {\n\n\t\t\toptions.view.transitionsEnabled = true;\n\t\t\t\n\t\t\tdeferred.resolve(options.view);\n\n\t\t}, function (error) {\n\t\t\tdeferred.reject(error, options.view);\n\t\t});\n\n\t\treturn promise;\n\t}\n\treturn render;\n});\n","define('ractivelib/render/unrender',['require','jquery'],function (require) {\n\n\tvar $ = require(\"jquery\");\n\n\tfunction unrender(options) {\n\n\t\tvar deferred = $.Deferred();\n\t\tvar promise = deferred.promise();\n\t\t\n\t\toptions.mvc.view.transitionsEnabled = false;\n\t\t//options.view.transitionsEnabled = false;\n\n\t\toptions.mvc.view.unrender().then(function () {\n\t\t//options.view.unrender(options.target).then(function () {\n\t\t\t\n\t\t\tdeferred.resolve(options.view);\n\n\t\t}, function (error) {\n\t\t\tdeferred.reject(error, options.view);\n\t\t});\n\n\t\treturn promise;\n\t}\n\treturn unrender;\n});\n","define('ractivelib/RactiveViewFactory',['require','./render/create','./render/render','./render/unrender'],function (require) {\n\n\tvar createView = require(\"./render/create\");\n\tvar renderView = require(\"./render/render\");\n\tvar unrenderView = require(\"./render/unrender\");\n\n\tfunction ractiveViewFactory() {\n\n\t\tvar that = {};\n\n\t\tthat.createView = function (options) {\n\t\t\treturn createView(options);\n\n\t\t};\n\t\t\n\t\tthat.renderView = function (options) {\n\t\t\treturn renderView(options);\n\t\t};\n\t\t\n\t\tthat.unrenderView = function (options) {\n\t\t\treturn unrenderView(options);\n\t\t};\n\n\t\treturn that;\n\t}\n\treturn new ractiveViewFactory();\n});\n","// Events order\n//    RACTIVE  -> CTRL       => GLOBAL EVENT\n//\t\t\t   ->            => viewBeforeInit\n//\t\t\t   -> onInit     => viewInit\n//   render    -> onRender   => viewRender\n//   complete  -> onComplete => viewComplete\n//             -> onRemove\n//                           => viewBeforeUnrender\n//   unrender  -> onUnrender => viewUnrender\n//   teardown\n//   \n//   -----\n// viewFail - should this event be supported?\n\ndefine('kudu',['require','./router/router','jquery','ractive','./utils/ajaxTracker','./utils/simpleAjaxTracker','./lifecycle/onInitHandler','./lifecycle/onRemoveHandler','./ractivelib/setupEvents','./ractivelib/setupDefaultEvents','./transition/intro','./transition/outro','./ractivelib/RactiveViewFactory','./utils/severity','./utils/utils'],function (require) {\n\n\tvar router = require(\"./router/router\");\n\tvar $ = require(\"jquery\");\n\tvar Ractive = require(\"ractive\");\n\tvar ajaxTrackerFn = require(\"./utils/ajaxTracker\");\n\tvar simpleAjaxTrackerFn = require(\"./utils/simpleAjaxTracker\");\n\tvar onInitHandler = require(\"./lifecycle/onInitHandler\");\n\tvar onRemoveHandler = require(\"./lifecycle/onRemoveHandler\");\n\tvar setupViewEvents = require(\"./ractivelib/setupEvents\");\n\tvar setupDefaultViewEvents = require(\"./ractivelib/setupDefaultEvents\");\n\tvar introFn = require(\"./transition/intro\");\n\tvar outroFn = require(\"./transition/outro\");\n\tvar ractiveViewFactory = require(\"./ractivelib/RactiveViewFactory\");\n\t//var unrenderView = require(\"./ractivelib/render/unrender\");\n\tvar severity = require(\"./utils/severity\");\n\tvar utils = require(\"./utils/utils\");\n\n\tfunction kudu() {\n\n\t\tvar that = {};\n\n\t\t// \n\t\tvar reenableAnimationTracker = {enable: true};\n\n\t\t//var routes;\n\n\t\tvar currentMVC = {\n\t\t\tview: null,\n\t\t\tctrl: null,\n\t\t\trequestTracker: {active: true},\n\t\t\troute: null,\n\t\t\toptions: null\n\t\t};\n\n\t\tvar callstack = [];\n\n\t\tvar initOptions = {\n\t\t\ttarget: null,\n\t\t\troutes: null,\n\t\t\tdefaultRoute: null,\n\t\t\tunknownRouteResolver: null,\n\t\t\tintro: null,\n\t\t\toutro: null,\n\t\t\tfx: false,\n\t\t\tviewFactory: ractiveViewFactory,\n\t\t\tdebug: true\n\t\t};\n\n\t\tvar ajaxTracker = ajaxTrackerFn(that);\n\n\t\tthat.init = function (options) {\n\t\t\t$.extend(initOptions, options);\n\t\t\tthat.validateInitOptions(initOptions);\n\t\t\t\n\t\t\t  Ractive.DEBUG = initOptions.debug;\n\n\t\t\trouter.on('routeload', function (routeOptions) {\n\t\t\t\tthat.routeLoaded(routeOptions);\n\t\t\t});\n\n\t\t\tsetupDefaultViewEvents(options);\n\n\t\t\trouter.init({\n\t\t\t\troutes: initOptions.routes,\n\t\t\t\tdefaultRoute: options.defaultRoute,\n\t\t\t\tunknownRouteResolver: options.unknownRouteResolver\n\t\t\t});\n\t\t};\n\t\t\n\t\tthat.router = function() {\n\t\t\treturn router;\n\t\t};\n\t\t\n\t\tthat.validateInitOptions = function(options) {\n\t\t\tif (options.viewFactory == null) {\n\t\t\t\tthrow new Error(\"viewFactory cannot be null!\");\n\t\t\t}\n\t\t\tif (options.viewFactory.createView == null) {\n\t\t\t\tthrow new Error(\"viewFactory must provide a createView function!\");\n\t\t\t}\n\t\t\tif (options.viewFactory.renderView == null) {\n\t\t\t\tthrow new Error(\"viewFactory must provide a renderView function!\");\n\t\t\t}\n\t\t\tif (options.viewFactory.unrenderView == null) {\n\t\t\t\tthrow new Error(\"viewFactory must provide an unrenderView function!\");\n\t\t\t}\t\t\t\n\t\t};\n\n\t\tthat.route = function (options) {\n\t\t\trouter.go(options);\n\t\t};\n\n\t\tthat.getDefaultTarget = function () {\n\t\t\treturn initOptions.target;\n\t\t};\n\n\t\tthat.routeLoaded = function (options) {\n\n\t\t\ttry {\n\t\t\t\tcallstack.push(1);\n\n\t\t\t\toptions.target = options.target || initOptions.target;\n\t\t\t\toptions.routeParams = options.routeParams || {};\n\t\t\t\toptions.args = options.args || {};\n\t\t\t\toptions.ajaxTracker = simpleAjaxTrackerFn.create(ajaxTracker, options);\n\n\t\t\t\t//options.requestTracker = currentMVC.requestTracker;\n\t\t\t\toptions.mvc = $.extend({}, currentMVC);\n\n\t\t\t\t// cancel and cleanup current view request (if there is one)\n\t\t\t\tcancelCurrentRequest(options);\n\n\t\t\t\t// Create a requestTracker for the new view\n\t\t\t\tvar requestTracker = {active: true};\n\t\t\t\tcurrentMVC.requestTracker = requestTracker;\n\t\t\t\toptions.mvc.requestTracker = requestTracker;\n\n\t\t\t\t// Disable transitions if view requests overwrite one another, eg when another view request is being processed still\n\t\t\t\tif (callstack.length > 1) {\n\t\t\t\t\t$.fx.off = true;\n\t\t\t\t\t$(options.target).stop(true, true);\n\t\t\t\t\treenableAnimationTracker.enable = false;\n\t\t\t\t}\n\n\t\t\t\tvar ctrl = that.createController(options.module);\n\t\t\t\toptions.ctrl = ctrl;\n\t\t\t\tdelete options.module;\n\t\t\t\t//options.requestTracker = currentMVC.requestTracker;\n\n\t\t\t\tif (currentMVC.ctrl == null) {\n\t\t\t\t\t// No view rendered so skip removing the current view and just init the new view\n\t\t\t\t\tprocessOnInit(options).then(function () {\n\n\t\t\t\t\t}, function () {\n\t\t\t\t\t\t// processOnInit failed\n\t\t\t\t\t\tcancelCurrentRequest(options);\n\n\t\t\t\t\t\tvar arg1 = arguments[0];\n\t\t\t\t\t\tif (arg1 != null && arg1.level < severity.ERROR) {\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t//TODO should viewFailed be called like this with args: var args = Array.slice.call( arguments );\n\t\t\t\t\t\t\tviewFailed(options, arguments);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t} else {\n\n\t\t\t\t\tprocessOnRemove(options).then(function () {\n\t\t\t\t\t\tprocessOnInit(options).then(function () {\n\n\t\t\t\t\t\t}, function () {\n\t\t\t\t\t\t\t// processOnInit failed\n\t\t\t\t\t\t\tcancelCurrentRequest(options);\n\n\t\t\t\t\t\t\tvar arg1 = arguments[0];\n\t\t\t\t\t\t\tif (arg1 != null && arg1.level < severity.ERROR) {\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t//TODO should viewFailed be called like this with args: var args = Array.slice.call( arguments );\n\t\t\t\t\t\t\t\tviewFailed(options, arguments);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}, function () {\n\t\t\t\t\t\t// processOnRemove failed\n\t\t\t\t\t\tcancelCurrentRequest(options);\n\t\t\t\t\t\tviewFailed(options, arguments);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t} catch (e) {\n\t\t\t\tviewFailed(options, [e]);\n\t\t\t}\n\t\t};\n\n\t\tthat.createController = function (Module) {\n\t\t\tif (Module instanceof Function) {\n\t\t\t\t// Instantiate new view\n\t\t\t\tvar result = new Module();\n\t\t\t\tif (result.id == null) {\n\t\t\t\t\tsetId(result, Module.id);\n\t\t\t\t}\n\t\t\t\treturn result;\n\n\t\t\t} else {\n\t\t\t\t// Module is not a Function, so assume it is an object and thus already instantiated\n\t\t\t\treturn Module;\n\t\t\t}\n\t\t};\n\n\t\tthat.processNewView = function (options) {\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\tsetupViewEvents(options);\n\n\t\t\tvar renderer;\n\n\t\t\tif (options.route.enter == null && (currentMVC.route == null || currentMVC.route.leave == null)) {\n\t\t\t\trenderer = that.renderViewWithAnimation;\n\t\t\t} else {\n\t\t\t\trenderer = that.customRenderView;\n\t\t\t}\n\n\t\t\trenderer(options).then(function () {\n\t\t\t\tthat.callViewEvent(\"onComplete\", options);\n\t\t\t\tthat.triggerEvent(\"viewComplete\", options);\n\t\t\t\tdeferred.resolve(options.view);\n\n\t\t\t}, function (error, view) {\n\t\t\t\t//viewFailed(options, [error]);\n\t\t\t\t// render Ractive rejeced\n\t\t\t\t//deferred.reject(error);\n\t\t\t\tdeferred.reject(error, view);\n\t\t\t});\n\n\t\t\t// Request could have been overwritten by new request. Ensure this is still the active request\n\t\t\tif (!options.mvc.requestTracker.active) {\n\t\t\t\tdeferred.reject(\"Request overwritten by another view request\");\n\t\t\t}\n\n\t\t\treturn promise;\n\t\t};\n\n\t\tthat.callViewEvent = function (eventName, options) {\n\n\t\t\tvar ctrl = options.ctrl;\n\t\t\tif (typeof ctrl[eventName] == 'function') {\n\t\t\t\tvar viewOptions = {\n\t\t\t\t\trouteParams: options.routeParams,\n\t\t\t\t\targs: options.args,\n\t\t\t\t\tview: options.view,\n\t\t\t\t\tajaxTracker: options.ajaxTracker\n\t\t\t\t};\n\t\t\t\tctrl[eventName](viewOptions);\n\t\t\t}\n\t\t};\n\n\t\tthat.triggerEvent = function (eventName, options) {\n\t\t\toptions = options || {};\n\t\t\toptions.mvc = options.mvc || {};\n\n\t\t\tvar isMainCtrlReplaced = initOptions.target === options.target;\n\n\t\t\t// If no controller has been defined, create a dummy one to pass to the event\n\t\t\tvar ctrl = options.ctrl;\n\t\t\tif (ctrl == null) {\n\t\t\t\tctrl = {};\n\t\t\t}\n\n\t\t\tvar triggerOptions = {\n\t\t\t\t//oldCtrl: currentMVC.ctrl,\n\t\t\t\toldCtrl: options.mvc.ctrl,\n\t\t\t\tnewCtrl: ctrl,\n\t\t\t\tisMainCtrl: isMainCtrlReplaced,\n\t\t\t\tctrlOptions: options,\n\t\t\t\teventName: eventName,\n\t\t\t\terror: options.error\n\t\t\t};\n\n\t\t\t$(that).trigger(eventName, [triggerOptions]);\n\t\t};\n\n\t\tfunction processOnInit(options) {\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\tvar onInitOptions = {\n\t\t\t\tctrl: options.ctrl,\n\t\t\t\trouteParams: options.routeParams,\n\t\t\t\targs: options.args,\n\t\t\t\tmvc: options.mvc,\n\t\t\t\tajaxTracker: options.ajaxTracker,\n\t\t\t\ttarget: options.target\n\t\t\t};\n\n\t\t\tthat.triggerEvent(\"viewBeforeInit\", options);\n\n\t\t\tonInitHandler(onInitOptions).then(function (viewOrPromise) {\n\n\t\t\t\toptions.viewOrPromise = viewOrPromise;\n\t\t\t\tthat.createView(options).then(function (view) {\n\n\t\t\t\t\toptions.view = view;\n\t\t\t\t\toptions.kudu = that;\n\t\t\t\t\tthat.triggerEvent(\"viewInit\", options);\n\n\t\t\t\t\tthat.processNewView(options).then(function (view) {\n\n\t\t\t\t\t\tonInitComplete();\n\t\t\t\t\t\tdeferred.resolve();\n\n\t\t\t\t\t}, function () {\n\t\t\t\t\t\t// processNewView rejected\n\t\t\t\t\t\tonInitComplete();\n\t\t\t\t\t\tdeferred.reject.apply(deferred, arguments);\n\t\t\t\t\t});\n\n\t\t\t\t}, function () {\n\t\t\t\t\t// view creation rejected\n\t\t\t\t\tonInitComplete();\n\t\t\t\t\tdeferred.reject.apply(deferred, arguments);\n\t\t\t\t\t//deferred.reject(arguments);\n\t\t\t\t});\n\n\t\t\t}, function () {\n\t\t\t\t// onInitHandler rejected\n\n\t\t\t\tonInitComplete();\n\t\t\t\tdeferred.reject.apply(deferred, arguments);\n\t\t\t});\n\n\t\t\treturn promise;\n\t\t}\n\n\t\tfunction processOnRemove(options) {\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\tvar onRemoveOptions = {\n\t\t\t\tctrl: currentMVC.ctrl,\n\t\t\t\tview: currentMVC.view,\n\t\t\t\trouteParams: currentMVC.options.routeParams,\n\t\t\t\targs: currentMVC.options.args,\n\t\t\t\t//requestTracker: currentMVC.requestTracker,\n\t\t\t\tmvc: options.mvc,\n\t\t\t\tajaxTracker: currentMVC.options.ajaxTracker,\n\t\t\t\ttarget: currentMVC.options.target\n\t\t\t\t\t\t//kudu: that\n\t\t\t};\n\n\t\t\tonRemoveHandler(onRemoveOptions).then(function () {\n\n\t\t\t\tthat.triggerEvent(\"viewBeforeUnrender\", options);\n\n\t\t\t\tdeferred.resolve();\n\n\t\t\t}, function () {\n\t\t\t\t// ctrl.onRemove failed or cancelled\n\t\t\t\t//options.view.transitionsEnabled = true;\n\n\t\t\t\tif (currentMVC.view != null) {\n\t\t\t\t\tcurrentMVC.view.transitionsEnabled = true;\n\t\t\t\t}\n\t\t\t\tdeferred.reject.apply(deferred, arguments);\n\t\t\t});\n\n\t\t\treturn promise;\n\t\t}\n\n\t\tthat.enter = function (options) {\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\tvar introOptions = {\n\t\t\t\tduration: 'fast',\n\t\t\t\ttarget: options.target,\n\t\t\t\tintro: initOptions.intro,\n\t\t\t\tfx: initOptions.fx || false\n\t\t\t};\n\n\t\t\tif (currentMVC.ctrl == null) {\n\t\t\t\tintroOptions.firstView = true;\n\t\t\t}\n\n\t\t\tthat.renderView(options).then(function () {\n\n\t\t\t\tintroFn(introOptions).then(function () {\n\t\t\t\t\tdeferred.resolve(options.view);\n\t\t\t\t});\n\n\t\t\t}, function (error, view) {\n\t\t\t\t// render Ractive rejeced\n\t\t\t\tdeferred.reject(error, view);\n\t\t\t});\n\n\t\t\treturn promise;\n\t\t};\n\n\t\tthat.leave = function (options) {\n\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\tvar outroOptions = {\n\t\t\t\tduration: 100,\n\t\t\t\ttarget: options.target,\n\t\t\t\toutro: initOptions.outro,\n\t\t\t\tfx: initOptions.fx || false\n\t\t\t};\n\n\t\t\tif (currentMVC.ctrl == null) {\n\t\t\t\toutroOptions.firstView = true;\n\t\t\t\toutroOptions.duration = 0;\n\t\t\t}\n\n\t\t\toutroFn(outroOptions).then(function () {\n\t\t\t\tif (!options.mvc.requestTracker.active) {\n\t\t\t\t\tdeferred.reject(\"Request overwritten by another view request\", options.view);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthat.unrenderView(options).then(function () {\n\t\t\t\t\tdeferred.resolve(options.view);\n\n\t\t\t\t}, function (error, view) {\n\t\t\t\t\tdeferred.reject(error, view);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn promise;\n\t\t};\n\n\t\tthat.renderViewWithAnimation = function (options) {\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\tthat.leave(options).then(function () {\n\t\t\t\tthat.enter(options).then(function () {\n\t\t\t\t\tdeferred.resolve(options.view);\n\t\t\t\t}, function (error, view) {\n\t\t\t\t\t// render Ractive rejeced\n\t\t\t\t\tdeferred.reject(error, view);\n\t\t\t\t});\n\t\t\t}, function (error, view) {\n\t\t\t\t// render Ractive rejeced\n\t\t\t\tdeferred.reject(error, view);\n\t\t\t});\n\n\t\t\t/*\n\t\t\t \n\t\t\t var outroOptions = {\n\t\t\t duration: 100,\n\t\t\t target: options.target,\n\t\t\t outro: initOptions.outro\n\t\t\t };\n\t\t\t var introOptions = {\n\t\t\t duration: 'fast',\n\t\t\t target: options.target,\n\t\t\t intro: initOptions.intro\n\t\t\t };\n\t\t\t if (currentMVC.ctrl == null) {\n\t\t\t outroOptions.firstView = introOptions.firstView = true;\n\t\t\t outroOptions.duration = 0;\n\t\t\t }\n\t\t\t \n\t\t\t outroFn(outroOptions).then(function () {\n\t\t\t if (!options.mvc.requestTracker.active) {\n\t\t\t deferred.reject(\"Request overwritten by another view request\");\n\t\t\t return;\n\t\t\t }\n\t\t\t \n\t\t\t that.unrenderView(options).then(function () {\n\t\t\t \n\t\t\t that.renderView(options).then(function () {\n\t\t\t \n\t\t\t introFn(introOptions).then(function () {\n\t\t\t deferred.resolve(options.view);\n\t\t\t });\n\t\t\t \n\t\t\t }, function (error, view) {\n\t\t\t // render Ractive rejeced\n\t\t\t deferred.reject(error, view);\n\t\t\t });\n\t\t\t \n\t\t\t }, function (error, view) {\n\t\t\t deferred.reject(error, view);\n\t\t\t });\n\t\t\t });\n\t\t\t */\n\n\t\t\treturn promise;\n\t\t};\n\n\t\tthat.customLeave = function (options) {\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\tvar leaveOptions = {\n\t\t\t\tctrl: options.ctrl,\n\t\t\t\tprevCtrl: currentMVC.ctrl,\n\t\t\t\tview: options.view,\n\t\t\t\tprevView: currentMVC.view,\n\t\t\t\troute: options.route,\n\t\t\t\tprevRoute: currentMVC.route,\n\t\t\t\ttarget: options.target\n\t\t\t};\n\n\t\t\tvar leaveFn;\n\t\t\tvar leaveCleanupFn;\n\n\t\t\tif (options.mvc.view == null) {\n\t\t\t\t// No view rendered yet, so we stub the leaveFn\n\t\t\t\tleaveFn = function () {\n\t\t\t\t};\n\t\t\t\tleaveCleanupFn = utils.noopPromise;\n\n\t\t\t} else {\n\n\t\t\t\tif (currentMVC.route != null) {\n\t\t\t\t\tleaveFn = currentMVC.route.leave;\n\t\t\t\t\tleaveCleanupFn = that.unrenderViewCleanup;\n\t\t\t\t}\n\n\t\t\t\t// If leave not defined or there is no view to unreder, fallback to unrenderView\n\t\t\t\tif (leaveFn == null) {\n\t\t\t\t\t//leaveFn = that.unrenderView;\n\t\t\t\t\tleaveFn = that.leave;\n\n\t\t\t\t\t//Since we unrederView we don't need to perform unrenderCleanup, so we stub it out\n\t\t\t\t\tleaveCleanupFn = utils.noopPromise;\n\n\t\t\t\t\tleaveOptions = options; // set leaveOptions to options, since we are going to use unrenderView instead\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar leavePromise = leaveFn(leaveOptions);\n\t\t\tif (leavePromise == null) {\n\t\t\t\tleavePromise = utils.noopPromise();\n\t\t\t}\n\n\t\t\tleavePromise.then(function () {\n\n\t\t\t\tleaveCleanupFn(options).then(function () {\n\t\t\t\t\tif (!options.mvc.requestTracker.active) {\n\t\t\t\t\t\tdeferred.reject(\"Request overwritten by another view request\", options.mvc.view);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tdeferred.resolve();\n\n\t\t\t\t}, function (error) {\n\t\t\t\t\tdeferred.reject(error, options.view);\n\t\t\t\t});\n\n\t\t\t}, function () {\n\t\t\t\tdeferred.reject(\"Error during route.leave()\");\n\t\t\t});\n\n\t\t\treturn promise;\n\t\t};\n\n\t\tthat.customEnter = function (options) {\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\tvar enterOptions = {\n\t\t\t\tctrl: options.ctrl,\n\t\t\t\tprevCtrl: currentMVC.ctrl,\n\t\t\t\tview: options.view,\n\t\t\t\tprevView: currentMVC.view,\n\t\t\t\troute: options.route,\n\t\t\t\tprevRoute: currentMVC.route,\n\t\t\t\ttarget: options.target\n\t\t\t};\n\n\t\t\tvar enterFn = options.route.enter;\n\t\t\tvar enterCleanupFn = that.renderViewCleanup;\n\n\t\t\t// If enter not defined, fallback to renderView\n\t\t\tif (enterFn == null) {\n\t\t\t\tenterFn = that.enter;\n\t\t\t\t//enterFn = that.renderView;\n\n\t\t\t\t//Since we unrederView we don't need to perform unrenderCleanup, so we stub it out\n\t\t\t\tenterCleanupFn = utils.noopPromise;\n\n\t\t\t\tenterOptions = options; // set leaveOptions to options, since we are going to use unrenderView instead\n\t\t\t}\n\n\t\t\tvar enterPromise = enterFn(enterOptions);\n\t\t\tif (enterPromise == null) {\n\t\t\t\tenterPromise = utils.noopPromise();\n\t\t\t}\n\n\t\t\tenterPromise.then(function () {\n\n\t\t\t\tenterCleanupFn(options).then(function () {\n\t\t\t\t\tdeferred.resolve(options.view);\n\n\t\t\t\t}, function (error) {\n\t\t\t\t\tdeferred.reject(error, options.view);\n\t\t\t\t});\n\n\t\t\t}, function () {\n\t\t\t\tdeferred.reject(\"Error during route.enter()\");\n\t\t\t});\n\n\t\t\treturn promise;\n\t\t};\n\n\t\t// User provided rendering during route setup\n\t\tthat.customRenderView = function (options) {\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\tthat.customLeave(options).then(function () {\n\n\t\t\t\tthat.customEnter(options).then(function () {\n\n\t\t\t\t\tdeferred.resolve(options.view);\n\n\t\t\t\t}, function (error, view) {\n\t\t\t\t\tdeferred.reject(error, view);\n\t\t\t\t});\n\n\t\t\t}, function (error, view) {\n\t\t\t\tdeferred.reject(error, view);\n\t\t\t});\n\n\t\t\treturn promise;\n\t\t};\n\n\t\tthat.createView = function (options) {\n\t\t\tvar promise = initOptions.viewFactory.createView(options);\n\t\t\treturn promise;\n\t\t};\n\n\t\tthat.renderView = function (options) {\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\t//options.view.transitionsEnabled = false;\n\n\t\t\tvar renderPromise = initOptions.viewFactory.renderView(options);\n\n\t\t\trenderPromise.then(function () {\n\n\t\t\t\tthat.renderViewCleanup(options).then(function () {\n\n\t\t\t\t\tdeferred.resolve(options.view);\n\n\t\t\t\t}, function (error) {\n\t\t\t\t\tdeferred.reject(error, options.view);\n\t\t\t\t});\n\n\n\t\t\t}, function (error) {\n\t\t\t\tdeferred.reject(error, options.view);\n\t\t\t});\n\n\t\t\treturn promise;\n\t\t};\n\n\t\tthat.renderViewCleanup = function (options) {\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\t// Store new controller and view on currentMVC\n\t\t\tthat.updateMVC(options);\n\n\t\t\t//options.view.transitionsEnabled = true;\n\n\t\t\t// Seems that Ractive render swallows errors so here we catch and log errors thrown by the viewRender event\n\t\t\ttry {\n\t\t\t\tthat.callViewEvent(\"onRender\", options);\n\t\t\t\tthat.triggerEvent(\"viewRender\", options);\n\n\t\t\t} catch (error) {\n\t\t\t\tdeferred.reject(error);\n\t\t\t\treturn promise;\n\t\t\t}\n\t\t\tdeferred.resolve();\n\t\t\treturn promise;\n\t\t};\n\n\t\tthat.unrenderView = function (options) {\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\tif (options.mvc.view == null) {\n\t\t\t\t// No view to unrender\n\t\t\t\tdeferred.resolve();\n\n\t\t\t} else {\n\n\t\t\t\t//options.mvc.view.transitionsEnabled = false;\n\t\t\t\tvar unrenderPromise = initOptions.viewFactory.unrenderView(options);\n\n\t\t\t\tunrenderPromise.then(function () {\n\t\t\t\t\t//options.mvc.view.unrender().then(function () {\n\n\t\t\t\t\tthat.unrenderViewCleanup(options).then(function () {\n\n\t\t\t\t\t\tif (!options.mvc.requestTracker.active) {\n\t\t\t\t\t\t\tdeferred.reject(\"Request overwritten by another view request\", options.mvc.view);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdeferred.resolve(options.mvc.view);\n\n\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\tdeferred.reject(error, options.view);\n\t\t\t\t\t});\n\n\t\t\t\t}, function () {\n\n\t\t\t\t\tdeferred.reject(options.mvc.view);\n\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn promise;\n\t\t};\n\n\t\tthat.unrenderViewCleanup = function (options) {\n\t\t\tvar deferred = $.Deferred();\n\t\t\tvar promise = deferred.promise();\n\n\t\t\t// Seems that Ractive unrender swallows errors so here we catch and log errors thrown by the viewUnrender event\n\t\t\ttry {\n\t\t\t\tthat.callViewEvent(\"onUnrender\", options);\n\t\t\t\tthat.triggerEvent(\"viewUnrender\", options);\n\n\t\t\t} catch (error) {\n\t\t\t\tdeferred.reject(error);\n\t\t\t\treturn promise;\n\t\t\t}\n\n\t\t\tdeferred.resolve();\n\t\t\treturn promise;\n\t\t};\n\n\t\tthat.updateMVC = function (options) {\n\t\t\tcurrentMVC.view = options.view;\n\t\t\tcurrentMVC.ctrl = options.ctrl;\n\t\t\tcurrentMVC.options = options;\n\t\t\tcurrentMVC.route = options.route;\n\t\t};\n\n\t\tfunction onInitComplete() {\n\t\t\tcallstack.splice(0, 1);\n\t\t\tif (callstack.length === 0) {\n\t\t\t\tconsole.log(\"AT 0\");\n\n\t\t\t\t// Delay switching on animation incase user is still clicking furiously\n\t\t\t\treenableAnimationTracker.enable = false;\n\t\t\t\treenableAnimationTracker = {enable: true};\n\t\t\t\treenableAnimations(reenableAnimationTracker);\n\t\t\t} else {\n\t\t\t\tconsole.log(\"AT \", callstack.length);\n\t\t\t}\n\t\t}\n\n\t\tfunction reenableAnimations(reenableAnimationTracker) {\n\t\t\t// We wait a bit before enabling animations in case user is still thrashing UI.\n\t\t\tsetTimeout(function () {\n\t\t\t\tif (reenableAnimationTracker.enable) {\n\t\t\t\t\t$.fx.off = false;\n\t\t\t\t}\n\t\t\t}, 350);\n\t\t}\n\n\t\t/*\n\t\t function setupRoutesByPaths(routes) {\n\t\t for (var key in routes) {\n\t\t if (routes.hasOwnProperty(key)) {\n\t\t var route = routes[key];\n\t\t that.addRouteByPath(route);\n\t\t }\n\t\t }\n\t\t }*/\n\n\t\tfunction viewFailed(options, errorArray) {\n\t\t\tvar errors = errorArray;\n\t\t\tif (!$.isArray(errorArray)) {\n\t\t\t\terrors = Array.prototype.slice.call(errorArray);\n\t\t\t}\n\t\t\toptions.error = errors;\n\t\t\tthat.triggerEvent(\"viewFail\", options);\n\n\t\t\tif (initOptions.debug) {\n\t\t\t\tif (options.error.length === 0) {\n\t\t\t\t\tconsole.error(\"error occurred!\", options);\n\n \t\t\t\t} else {\n\t\t\t\t\tconsole.error(options.error[0], options);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction cancelCurrentRequest(options) {\n\n\t\t\t// Check if request has already been overwritten\n\t\t\tif (options.mvc.requestTracker.active === false) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// current controller has been overwritten by new request\n\t\t\toptions.mvc.requestTracker.active = false;\n\n\t\t\tajaxTracker.abort(options.target);\n\t\t\tajaxTracker.clear(options.target);\n\n\t\t}\n\n\t\tfunction setId(obj, id) {\n\t\t\t// Create an ID property which isn't writable or iteratable through for in loops.\n\t\t\tif (!obj.id) {\n\t\t\t\tObject.defineProperty(obj, \"id\", {\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: false,\n\t\t\t\t\tvalue: id\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn that;\n\t}\n\n\tvar result = kudu();\n\treturn result;\n});\n\n"]}